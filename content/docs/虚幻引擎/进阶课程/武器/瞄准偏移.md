---
title: "瞄准偏移"
date: 2023-08-16T13:59:48
lastmod: 2023-08-16T22:38:35+08:00
draft: false
weight: 1009
---

## 概览 {#概览}

`Aim Offset` <br/>


### 瞄准偏移资产 {#瞄准偏移资产}

`Aim Offset` <br/>

1.  专门用于瞄准 <br/>
2.  有常规和1D两种, 和混合空间一样 <br/>
3.  常规AimOffset有两个轴, 覆盖瞄准在水平和垂直方向的偏移 <br/>
4.  需要绑定骨骼网格体 <br/>
5.  命名前缀为AO\_ <br/>


### 本节会创建瞄准偏移资产, 支持水平和垂直方向的偏移, 但只使用垂直方向的偏移 {#本节会创建瞄准偏移资产-支持水平和垂直方向的偏移-但只使用垂直方向的偏移}

射击瞄准相较之前自然一些 <br/>


### 使用到的动画资产 {#使用到的动画资产}

| -                 |
|-------------------|
| AimOffsetFwd      |
| AimOffsetUp       |
| AimOffsetDown     |
| AimOffsetLeft     |
| AimOfsetLeftDown  |
| AimOffsetLeftUp   |
| AimOffsetRight    |
| AimOfsetRightDown |
| AimOffsetRightUp  |


### 垂直方向的偏移来自CameraComponent前进向量在垂直方向的分量 {#垂直方向的偏移来自cameracomponent前进向量在垂直方向的分量}

1.  通过游戏角色控制器旋转CameraComponent实现游戏角色的视角旋转 <br/>
2.  水平旋转游戏角色时, 身体跟随 <br/>


## 绘制CameraComponent的前进向量 {#绘制cameracomponent的前进向量}

获取CameraComponent的旋转分量, 通过旋转分量获取前进向量 <br/>


### 在动画蓝图EventGraph计算CameraComponent旋转分量 {#在动画蓝图eventgraph计算cameracomponent旋转分量}

`ABP_BaseCharacter > EventGraph` <br/>


#### 获取CameraComponent的旋转分量 {#获取cameracomponent的旋转分量}

| -  |                                                                 |
|----|-----------------------------------------------------------------|
| 输入 | Pawn                                                            |
| 函数 | GetBaseAimRotation: 通过Pawn的Controller返回游戏角色CameraComponent的旋转分量 |

<!--list-separator-->

-  保存旋转分量到变量, AnimGraph中会用到

    1.  `Promote to Variable` <br/>
        
        <img src="/pic/武器/瞄准偏移/PromoteToVariable.png" width="800" /> <br/> <br/>
    2.  变量列表出现新变量, 命名为AimRotation <br/>
        
        <img src="/pic/武器/瞄准偏移/NameAimRotation.png" width="350" /> <br/> <br/>

<!--list-separator-->

-  完整实现

    <img src="/pic/武器/瞄准偏移/AimRotation.png" width="700" /> <br/> <br/>


### 根据旋转分量获取CameraComponent的前进分量, 使用DrawDebugLine绘制 {#根据旋转分量获取cameracomponent的前进分量-使用drawdebugline绘制}

| -  |                        |                                                    |
|----|------------------------|----------------------------------------------------|
| 起点 | 游戏角色位置           | Pawn &gt; GetActorLocation                         |
| 偏移 | 放大的CameraComponent前进向量 | Pawn &gt; GetBaseAimRotation &gt; GetForwardVector |
| 终点 | 起点 + 偏移            |                                                    |

1.  乘法输入转为float: 右键另一个输入 <br/>
    
    <img src="/pic/武器/瞄准偏移/乘法输入转为float.png" width="400" /> <br/> <br/>
2.  DrawDebugLine参数 <br/>
    
    | -          |     |
    |------------|-----|
    | Duration   | 0.0 |
    | Thickness  | 3.0 |
    | Line Color |     |
3.  实现 <br/>
    
    <img src="/pic/武器/瞄准偏移/CameraComponentForwardVector.png" width="1000" /> <br/> <br/>


## 创建瞄准偏移资产 {#创建瞄准偏移资产}

`Aim Offset` <br/>

1.  Content/Player/Animations文件夹空白处右键, 选择AimOffset <br/>
    
    <img src="/pic/武器/瞄准偏移/创建AO_BaseCharacter.png" width="1000" /> <br/> <br/>
2.  选择骨骼网格体 `HeroTPP_Skeleton` <br/>
3.  命名为AO_BaseCharacter <br/>


## 导入AimOffset相关动画 {#导入aimoffset相关动画}

之前导入的动画资产打开导致程序挂死, 不用亦不删除, 从ShooterGame单独导入 <br/>


### 从ShooterGame迁移 {#从shootergame迁移}

`ShooterGame` <br/>

1.  选中Content/Animations/TTP_Animations，右键，选择Migrate <br/>
    
    <img src="/pic/武器/瞄准偏移/TTP_Animations-Migrate.png" width="400" /> <br/> <br/>
2.  仅勾选AimOffset相关动画，共9个 <br/>
    
    <img src="/pic/武器/瞄准偏移/AimOffsets.png" width="300" /> <br/> <br/>


### 放入指定位置 {#放入指定位置}

`ShootThemUp` <br/>

1.  重命名Content/Animations/TTP_Animations为AimOffsetAnimation，移动到Content/ExternalContent目录下, 删除Content/Animations <br/>
2.  挨个双击动画资产, 为其绑定骨骼网格体HeroTPP <br/>
3.  为文件夹设置颜色 <br/>
    
    <img src="/pic/武器/瞄准偏移/AimOffsetAnimation.png" width="900" /> <br/> <br/>


## 配置AO_BaseCharacter {#配置ao-basecharacter}

双击打开, 面板和混合空间一样 <br/>


### 配置轴 {#配置轴}

| -  | Name  | 范围     |
|----|-------|--------|
| 水平 | Yaw   | -90 ~ 90 |
| 垂直 | Pitch | -90 ~ 90 |

<img src="/pic/武器/瞄准偏移/AO_BaseCharacter-Axis.png" width="300" /> <br/> <br/>


### 要求Asset Browser有以下动画 {#要求asset-browser有以下动画}

| -                 |
|-------------------|
| AimOffsetFwd      |
| AimOffsetUp       |
| AimOffsetDown     |
| AimOffsetLeft     |
| AimOfsetLeftDown  |
| AimOffsetLeftUp   |
| AimOffsetRight    |
| AimOfsetRightDown |
| AimOffsetRightUp  |

这些动画倾向于作为姿势, 由少数帧组成 <br/>


### 调整动画资产参数以兼容AimOffset资产 {#调整动画资产参数以兼容aimoffset资产}

使得这些动画可以附加到已有姿势上 <br/>

依次打开9个动画资产, 做如下设置: <br/>

1.  `Asset Details > Additive Settings, 将Additive Anim Type设置Mesh Space` <br/>
    AnimOffset只和该类型动画兼容 <br/>
2.  `Base Pose Type默认为Selected animation frame` <br/>
3.  `选择动画Idle` <br/>

<img src="/pic/武器/瞄准偏移/AdditiveSettings.png" width="300" /> <br/>    <br/>


### 配置瞄准偏移资产AO_BaseCharacter {#配置瞄准偏移资产ao-basecharacter}

|                   | (Yaw, Pitch) |
|-------------------|--------------|
| AimOffsetFwd      | (0, 0)       |
| AimOffsetUp       | (0, 90)      |
| AimOffsetDown     | (0, -90)     |
| AimOffsetLeft     | (-90, 0)     |
| AimOfsetLeftDown  | (-90, -90)   |
| AimOffsetLeftUp   | (-90, 90)    |
| AimOffsetRight    | (90, 0)      |
| AimOfsetRightDown | (90, -90)    |
| AimOffsetRightUp  | (90, 90)     |

将9个动画拖入到指定位置, 调整座标 <br/>

1.  动画座标配置 <br/>
    
    <img src="/pic/武器/瞄准偏移/动画座标1.png" width="400" /> <br/> <br/>
    
    <img src="/pic/武器/瞄准偏移/动画座标2.png" width="400" /> <br/> <br/>
2.  分布 <br/>
    
    <img src="/pic/武器/瞄准偏移/AimOffset动画座标完整.png" width="700" /> <br/> <br/>

正常情况下, 给玩家所控制的游戏角色添加在垂直方向旋转已经足够. CameraComponent在水平方向旋转时, 游戏角色骨骼网格体自然跟随. <br/>

自定义角色不会有侧面旋转 <br/>

如果希望AI的旋转更写实, 则需要继续设置水平方向的旋转. <br/>


### 在动画蓝图ABP_BaseCharacter中使用瞄准偏移资产 {#在动画蓝图abp-basecharacter中使用瞄准偏移资产}

`AnimGraph` <br/>
在计算运动姿势之后, 添加AimOffset <br/>

1.  将AO_BaseCharacter拖入AnimGraph, Locomotion作为其输入, 输出作为Slot的输入 <br/>
    
    <img src="/pic/武器/瞄准偏移/在动画蓝图ABP_BaseCharacter中使用瞄准偏移资产.png" width="800" /> <br/> <br/>
2.  可以设置AO_BaseCharacter的(Yaw, Pitch), 编译, 在窗口检视Idle姿势在该设置下的AimOffset效果 <br/>
    
    | -        |    |
    |----------|----|
    | (90, 0)  | 右转 |
    | (90, 45) | 右下 |
3.  还可以设置Velocity的默认值, 查看运动时的AimOffset效果 <br/>
    如将Velocity设置为500 <br/>
4.  在AnimGraph获取AimRotation变量, 使用Pitch分量(垂直); 玩家控制游戏角色时的水平旋转角度不合理, 所以不使用Yaw <br/>
    
    <img src="/pic/武器/瞄准偏移/使用AimRotationPitch.png" width="800" /> <br/> <br/>


## 查看垂直方向的瞄准偏移 {#查看垂直方向的瞄准偏移}

武器跟随游戏角色动画偏移，从枪口出来的射线经过瞄准十字 <br/>

<img src="/pic/武器/瞄准偏移/垂直瞄准偏移.png" width="800" /> <br/> <br/>

