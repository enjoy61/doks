---
title: "瞄准偏移"
date: 2023-08-16T13:59:48
lastmod: 2023-08-18T18:25:23+08:00
draft: false
weight: 1009
---

## 说明 {#说明}

-   游戏角色视角水平旋转时, 身体会跟随; 垂直方向旋转时, 缺乏相应动画 <br/>
-   使用瞄准偏移资产, 游戏角色视角垂直旋转时, 显示相应动画 <br/>
-   游戏角色视角垂直旋转和Camera组件垂直旋转一致, 使用后者旋转角度矫正动画 <br/>


## 概览 {#概览}

-   [X] 导入AimOffset相关动画 <br/>
-   [X] 绘制Camera组件的前进向量 <br/>
-   [X] 创建瞄准偏移资产 <br/>


## 绘制Camera组件的前进向量 {#绘制camera组件的前进向量}

`虚幻编辑器` <br/>


### 在蓝图中获取Camera组件前进向量 {#在蓝图中获取camera组件前进向量}

`ABP_BaseCharacter > EventGraph` <br/>

| 函数               |                                             |
|------------------|---------------------------------------------|
| GetBaseAimRotation | 通过Pawn的Controller返回游戏角色CameraComponent的旋转分量 |
| GetForwardVector   | 从FRotator获取前进分量                      |


#### 保存旋转分量到变量, AnimGraph中会用到 {#保存旋转分量到变量-animgraph中会用到}

1.  `Promote to Variable` <br/>
    
    <img src="/pic/武器/瞄准偏移/PromoteToVariable.png" width="800" /> <br/> <br/>
2.  变量列表出现新变量, 命名为AimRotation <br/>
    
    <img src="/pic/武器/瞄准偏移/NameAimRotation.png" width="350" /> <br/> <br/>


#### 完整实现 {#完整实现}

<img src="/pic/武器/瞄准偏移/AimRotation.png" width="700" /> <br/> <br/>


### 获取游戏角色位置 GetActorLocation {#获取游戏角色位置-getactorlocation}


### 绘制Camera组件前进方向 {#绘制camera组件前进方向}

| -  |                 |
|----|-----------------|
| 起点 | 游戏角色位置    |
| 偏移 | 放大的Camera组件前进向量 |
| 终点 | 起点 + 偏移     |

1.  乘法输入转为float: 右键另一个输入 <br/>
    
    <img src="/pic/武器/瞄准偏移/乘法输入转为float.png" width="400" /> <br/> <br/>
2.  线段参数 <br/>
    
    | -          |     |
    |------------|-----|
    | Duration   | 0.0 |
    | Thickness  | 3.0 |
    | Line Color |     |
3.  使用DrawDebugLine绘制 <br/>
    
    <img src="/pic/武器/瞄准偏移/CameraComponentForwardVector.png" width="1000" /> <br/> <br/>


## 瞄准偏移资产 {#瞄准偏移资产}

`Aim Offset` <br/>

1.  专门用于瞄准 <br/>
2.  有常规和1D两种, 和混合空间一样 <br/>
3.  常规AimOffset有两个轴, 覆盖瞄准在水平和垂直方向的偏移 <br/>
4.  需要绑定骨骼 <br/>
5.  命名前缀为AO\_ <br/>


## 创建瞄准偏移资产 {#创建瞄准偏移资产}


### 导入AimOffset相关动画 {#导入aimoffset相关动画}

之前导入的动画资产打开导致程序挂死, 不用亦不删除, 从ShooterGame单独导入 <br/>


#### 使用到的动画资产 {#使用到的动画资产}

这些动画倾向于作为姿势, 由少数帧组成 <br/>

| -                 |
|-------------------|
| AimOffsetFwd      |
| AimOffsetUp       |
| AimOffsetDown     |
| AimOffsetLeft     |
| AimOfsetLeftDown  |
| AimOffsetLeftUp   |
| AimOffsetRight    |
| AimOfsetRightDown |
| AimOffsetRightUp  |


#### 从ShooterGame迁移 {#从shootergame迁移}

`ShooterGame` <br/>

1.  选中Content/Animations/TTP_Animations，右键，选择Migrate <br/>
    
    <img src="/pic/武器/瞄准偏移/TTP_Animations-Migrate.png" width="400" /> <br/> <br/>
2.  仅勾选AimOffset相关动画，共9个 <br/>
    
    <img src="/pic/武器/瞄准偏移/AimOffsets.png" width="300" /> <br/> <br/>


#### 放入指定位置并绑定骨骼 {#放入指定位置并绑定骨骼}

`ShootThemUp` <br/>

1.  重命名Content/Animations/TTP_Animations为AimOffsetAnimation，移动到Content/ExternalContent目录下, 删除Content/Animations <br/>
2.  动画资产全选打开, 为其绑定骨骼HeroTPP_Skeleton <br/>
3.  为文件夹设置颜色 <br/>
    
    <img src="/pic/武器/瞄准偏移/AimOffsetAnimation.png" width="900" /> <br/> <br/>


### 创建瞄准偏移资产 {#创建瞄准偏移资产}

`Aim Offset` <br/>

1.  Content/Player/Animations文件夹空白处右键, 选择AimOffset <br/>
    
    <img src="/pic/武器/瞄准偏移/创建AO_BaseCharacter.png" width="1000" /> <br/> <br/>
2.  选择骨骼网格体 `HeroTPP_Skeleton` <br/>
3.  命名为AO_BaseCharacter <br/>


### 配置瞄准偏移资产 {#配置瞄准偏移资产}

`AO_BaseCharacter` <br/>
双击打开, 面板和混合空间一样 <br/>


#### 配置轴 {#配置轴}

| -  | Name  | 范围     |
|----|-------|--------|
| 水平 | Yaw   | -90 ~ 90 |
| 垂直 | Pitch | -90 ~ 90 |

<img src="/pic/武器/瞄准偏移/AO_BaseCharacter-Axis.png" width="300" /> <br/> <br/>


#### 要求Asset Browser有以下动画 {#要求asset-browser有以下动画}

| -                 |
|-------------------|
| AimOffsetFwd      |
| AimOffsetUp       |
| AimOffsetDown     |
| AimOffsetLeft     |
| AimOfsetLeftDown  |
| AimOffsetLeftUp   |
| AimOffsetRight    |
| AimOfsetRightDown |
| AimOffsetRightUp  |


#### 调整动画资产参数以兼容AimOffset资产 {#调整动画资产参数以兼容aimoffset资产}

使得这些动画可以附加到已有姿势上 <br/>

依次打开9个动画资产, 做如下设置: <br/>

1.  `Asset Details > Additive Settings, 将Additive Anim Type设置Mesh Space` <br/>
    AnimOffset只和该类型动画兼容 <br/>
2.  `Base Pose Type默认为Selected animation frame` <br/>
3.  `选择动画Idle` <br/>

<img src="/pic/武器/瞄准偏移/AdditiveSettings.png" width="300" /> <br/>    <br/>


#### 使用AimOffset相关动画 {#使用aimoffset相关动画}

|                   | (Yaw, Pitch) |
|-------------------|--------------|
| AimOffsetFwd      | (0, 0)       |
| AimOffsetUp       | (0, 90)      |
| AimOffsetDown     | (0, -90)     |
| AimOffsetLeft     | (-90, 0)     |
| AimOfsetLeftDown  | (-90, -90)   |
| AimOffsetLeftUp   | (-90, 90)    |
| AimOffsetRight    | (90, 0)      |
| AimOfsetRightDown | (90, -90)    |
| AimOffsetRightUp  | (90, 90)     |

<!--list-separator-->

-  将9个动画拖入到指定位置, 调整座标

    1.  动画座标配置 <br/>
        
        <img src="/pic/武器/瞄准偏移/动画座标1.png" width="400" /> <br/> <br/>
        
        <img src="/pic/武器/瞄准偏移/动画座标2.png" width="400" /> <br/> <br/>
    2.  效果 <br/>
        
        <img src="/pic/武器/瞄准偏移/AimOffset动画座标完整.png" width="700" /> <br/> <br/>


#### 说明 {#说明}

1.  AO_BaseCharacter在水平和垂直方向都有输入, 本节中, 只配置垂直输入 <br/>
2.  对于玩家操控的游戏角色, 旋转视角时, 在水平和垂直方向都有动画; 我们也不需要看到游戏角色的侧面旋转 <br/>
3.  如果希望AI的旋转更写实, 则需要配置水平输入 <br/>


### 在动画蓝图中使用瞄准偏移资产 {#在动画蓝图中使用瞄准偏移资产}

`ABP_BaseCharacter > AnimGraph` <br/>

计算运动姿势之后, 添加瞄准偏移 <br/>

1.  将AO_BaseCharacter拖入AnimGraph, Locomotion作为其输入, 输出作为Slot的输入 <br/>
    
    <img src="/pic/武器/瞄准偏移/在动画蓝图ABP_BaseCharacter中使用瞄准偏移资产.png" width="800" /> <br/> <br/>
2.  可以调试AO_BaseCharacter的(Yaw, Pitch), 编译后, 在窗口检视Idle姿势在该设置下的AimOffset效果 <br/>
    
    | -        |    |
    |----------|----|
    | (90, 0)  | 右转 |
    | (90, 45) | 右下 |
3.  以设调试Velocity, 查看运动时的瞄准偏移效果 <br/>
4.  获取AimRotation变量, 使用Pitch分量(垂直); Camera组件旋转的水平分量与侧面动画不一致, 并不能用作Yaw的输入 <br/>
    
    <img src="/pic/武器/瞄准偏移/使用AimRotationPitch.png" width="800" /> <br/> <br/>


## 查看垂直方向的瞄准偏移 {#查看垂直方向的瞄准偏移}

武器跟随游戏角色在垂直方向旋转, 射击瞄准相较之前自然一些 <br/>

<img src="/pic/武器/瞄准偏移/垂直瞄准偏移.png" width="800" /> <br/> <br/>

