---
title: "绘制瞄准十字"
date: 2023-06-21T19:03:08
lastmod: 2023-08-17T04:30:15+08:00
draft: false
weight: 1003
---

## 概览 {#概览}

瞄准十字：垂直的两条线，处于屏幕正中间 <br/>

-   [X] 创建抬头显示类STUGameHUD <br/>
-   [X] 设置关卡使用STUGameHUD, 绘制瞄准十字 <br/>
-   [X] 调整SpringArm组件的Camera偏移, 使得游戏角色在瞄准十字左侧 <br/>
-   [X] 调整HealthText组件, 生命值对敌人可见, 对自己不可见 <br/>
-   [X] 在代码中设置SpringArm组件Socket偏移和TextRender组件渲染标志位的方法 <br/>


## HUD {#hud}

`Head-Up Display` <br/>
抬头显示, 包含一些常用信息 <br/>

用得不多, 很多功能使用Widget完成 <br/>

[AHUD](/docs/虚幻引擎/api/虚幻c++/关卡设置/hud类/#ahud) <br/>


## 创建抬头显示类 {#创建抬头显示类}


### 创建C++类: UI/STUGameHUD {#创建c-plus-plus-类-ui-stugamehud}

`虚幻编辑器` <br/>

-   `Actor > AHUD` <br/>
    
    <img src="/pic/武器/绘制瞄准十字/AHUD.png" width="800" /> <br/> <br/>
-   `公有类` <br/>
    
    <img src="/pic/武器/绘制瞄准十字/AHUD-Public.png" width="800" /> <br/> <br/>


### 更新头文件搜索路径 {#更新头文件搜索路径}

`C++` <br/>
`ShootThemUp: ShootThemUp.Build.cs` <br/>

```csharp
PublicIncludePaths.AddRange(new string[] 
{
    "ShootThemUp/Public/Player",
    "ShootThemUp/Public/Components",
    "ShootThemUp/Public/Dev",
    "ShootThemUp/Public/Weapon",
    "ShootThemUp/Public/UI"
});
```


## 绘制瞄准十字 {#绘制瞄准十字}

`虚幻C++` <br/>


### 设置关卡使用STUGameHUD {#设置关卡使用stugamehud}

[AGameModeBase::HUDClass](/docs/虚幻引擎/api/虚幻c++/关卡设置/gamemodebase类/#agamemodebase-hudclass) <br/>

`ShootThemUp: STUGameModeBase.cpp` <br/>

```cpp
#include "UI/STUGameHUD.h"

// ASTUGameModeBase
HUDClass = ASTUGameHUD::StaticClass();
```


### 获取屏幕中心位置 {#获取屏幕中心位置}

通过AHUD::Canvas获取屏幕长和宽，中心点保存到TInterval类型变量 <br/>

[AHUD::Canvas](/docs/虚幻引擎/api/虚幻c++/关卡设置/hud类/#ahud-canvas) <br/>
[UCanvas](/docs/虚幻引擎/api/虚幻c++/engine/canvas类/#ucanvas) <br/>
[UCanvas::SizeX 和 UCanvas::SizeY](</docs/虚幻引擎/api/虚幻c++/engine/canvas类/#ucanvas-sizex 和 ucanvas-sizey>) <br/>

[TInterval](/docs/虚幻引擎/api/虚幻c++/数据结构/interval模板类/#tinterval) <br/>

```cpp
#include "Engine/Canvas.h"

// DrawCrossHair
const TInterval<float> Center(Canvas->SizeX * 0.5f, Canvas->SizeY * 0.5f);
```


### 线条参数 {#线条参数}

|    | -                 |
|----|-------------------|
| 长度 | HalfLineSize \* 2 |
| 颜色 | LineColor         |
| 粗细 | LineThickness     |

```cpp
const float HalfLineSize = 10.0f;
const float LineThickness = 2.0f;
const FLinearColor LineColor = FLinearColor::Green;
```


### 以中心点为基准, 得到横竖两条线的起点和终点 {#以中心点为基准-得到横竖两条线的起点和终点}

[TInterval::Min 和 TInterval::Max](</docs/虚幻引擎/api/虚幻c++/数据结构/interval模板类/#tinterval-min 和 tinterval-max>) <br/>

|   | 起点                                    | 终点                                    |
|---|---------------------------------------|---------------------------------------|
| 横 | (Center.Min - HalfLineSize, Center.Max) | (Center.Min + HalfLineSize, Center.Max) |
| 竖 | (Center.Min, Center.Max - HalfLineSize) | (Center.Min, Center.Max + HalfLineSize) |


### 使用AHUD::DrawLine绘制线条 {#使用ahud-drawline绘制线条}

[AHUD::DrawLine](/docs/虚幻引擎/api/虚幻c++/关卡设置/hud类/#ahud-drawline) <br/>

```cpp
DrawLine(Center.Min, Center.Max - HalfLineSize, Center.Min, Center.Max + HalfLineSize, LineColor, LineThickness);
DrawLine(Center.Min - HalfLineSize, Center.Max, Center.Min + HalfLineSize, Center.Max, LineColor, LineThickness);
```


### 完整实现: DrawCrossHair {#完整实现-drawcrosshair}

1.  `ShootThemUp: UI/STUGameHUD.h` <br/>
    `private` <br/>
    ```cpp
    void DrawCrossHair();
    ```
2.  `ShootThemUp: UI/STUGameHUD.cpp` <br/>
    ```cpp
    void ASTUGameHUD::DrawCrossHair()
    {
        const TInterval<float> Center(Canvas->SizeX * 0.5f, Canvas->SizeY * 0.5f);
    
        const float HalfLineSize = 10.0f;
        const float LineThickness = 2.0f;
        const FLinearColor LineColor = FLinearColor::Green;
    
        DrawLine(Center.Min, Center.Max - HalfLineSize, Center.Min, Center.Max + HalfLineSize, LineColor, LineThickness);
        DrawLine(Center.Min - HalfLineSize, Center.Max, Center.Min + HalfLineSize, Center.Max, LineColor, LineThickness);
    }
    ```


### 覆写AHUD::DrawHUD，调用DrawCorssHair {#覆写ahud-drawhud-调用drawcorsshair}

AHUD对象每帧都会调用DrawHUD函数 <br/>
[AHUD::DrawHUD](/docs/虚幻引擎/api/虚幻c++/关卡设置/hud类/#ahud-drawhud)       <br/>

1.  `ShootThemUp: UI/STUGameHUD.h` <br/>
    `public` <br/>
    ```cpp
    virtual void DrawHUD() override;
    ```
2.  `ShootThemUp: UI/STUGameHUD.cpp` <br/>
    ```cpp
    void ASTUGameHUD::DrawHUD()
    {
        Super::DrawHUD();
        DrawCrossHair();
    }
    ```


## 查看 {#查看}

`虚幻编辑器` <br/>

1.  关卡使用STUGameHUD <br/>
    
    <img src="/pic/武器/绘制瞄准十字/世界设置-STUGameHUD.png" width="400" /> <br/> <br/>
2.  操控游戏角色移动, 或者调整屏幕大小，绿色十字总在屏幕中心位置 <br/>
    
    <img src="/pic/武器/绘制瞄准十字/绿色十字.png" width="800" /> <br/> <br/>


## 设置SpringArm组件的Camera偏移: 使得游戏角色在瞄准十字左侧 {#设置springarm组件的camera偏移-使得游戏角色在瞄准十字左侧}

`虚幻编辑器` <br/>

1.  `打开BP_STUBaseCharacter，选中SpringArmComponent > Details > Camera > Socket Offset，设置Y偏移100` <br/>
    
    <img src="/pic/武器/绘制瞄准十字/SpringArm-SocketOffset.png" width="1200" /> <br/> <br/>
2.  效果图: Camera组件在游戏角色的右·上·后方 <br/>
    
    <img src="/pic/武器/绘制瞄准十字/效果图.png" width="800" /> <br/> <br/>


## 设置HealthText组件: 生命值对敌人可见, 对自己不可见 {#设置healthtext组件-生命值对敌人可见-对自己不可见}

`虚幻编辑器` <br/>

| 渲染标志位     |                         |                            |
|-----------|-------------------------|----------------------------|
| Owner No See   | 玩家可以看见他人游戏角色的生命值，看不见自己的 | 渲染别人家的TextComponent，不渲染自家的 |
| Only Owner See | 玩家只能看见自己游戏角色的生命值 | 渲染自家的TextComponent    |


### 设置标志位 {#设置标志位}

1.  打开BP_STUBaseCharacter，选中HealthTextComponent, 去到Details <br/>
2.  搜索Owner，勾选 `Owner No See` <br/>
    
    <img src="/pic/武器/绘制瞄准十字/HealthText-OwnerNoSee.png" width="1000" /> <br/> <br/>


### 旋转文本, 显示给敌人看 {#旋转文本-显示给敌人看}

<img src="/pic/武器/绘制瞄准十字/HealthText-Rotation.png" width="1000" /> <br/> <br/>


### 在关卡中添加BP_STUBaseCharacter对象，查看效果 {#在关卡中添加bp-stubasecharacter对象-查看效果}

<img src="/pic/武器/绘制瞄准十字/效果图2.png" width="800" /> <br/> <br/>


## 在代码中设置SpringArm组件Socket偏移和TextRender组件渲染标志位的方法 {#在代码中设置springarm组件socket偏移和textrender组件渲染标志位的方法}

`C++` <br/>
`ShootThemUp: Player/STUBaseCharacter.cpp` <br/>


### 设置SpringArm组件的Camera偏移 {#设置springarm组件的camera偏移}

[USpringArmComponent::SocketOffset](/docs/虚幻引擎/api/虚幻c++/组件/springarm组件/#uspringarmcomponent-socketoffset) <br/>

```cpp
// 构造函数
SpringArmComponent->SocketOffset = FVector(0.0f, 100.0f, 80.0f);
```


### 设置TextRender组件的OwnerNoSee标志位 {#设置textrender组件的ownernosee标志位}

[UPrimitiveComponent::SetOwnerNoSee](/docs/虚幻引擎/api/虚幻c++/组件/primitive组件/#uprimitivecomponent-setownernosee) <br/>

```cpp
// 构造函数
HealthTextComponent->SetOwnerNoSee(true);
```

