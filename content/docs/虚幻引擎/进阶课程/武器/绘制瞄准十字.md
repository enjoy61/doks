---
title: "绘制瞄准十字"
date: 2023-06-21T19:03:08
lastmod: 2023-08-08T19:26:09+08:00
draft: false
weight: 1002
---

## 概览 {#概览}

瞄准十字：垂直的两条线，处于屏幕正中间 <br/>

| 虚幻C++                                                                                                      |                                                                                                                         |
|------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------|
| [AGameModeBase::HUDClass](/docs/虚幻引擎/api/虚幻c++/关卡设置/gamemodebase类/#agamemodebase-hudclass)        | 设置关卡使用的HUD类                                                                                                     |
| [AHUD](/docs/虚幻引擎/api/虚幻c++/关卡设置/hud类/#ahud)                                                      | 始终显示在游戏                                                                                                          |
| [AHUD::DrawHUD](/docs/虚幻引擎/api/虚幻c++/关卡设置/hud类/#ahud-drawhud)                                     | 循环体，每帧调用                                                                                                        |
| [AHUD::Canvas](/docs/虚幻引擎/api/虚幻c++/关卡设置/hud类/#ahud-canvas)                                       | 数据成员，获取屏幕信息                                                                                                  |
| [AHUD::DrawLine](/docs/虚幻引擎/api/虚幻c++/关卡设置/hud类/#ahud-drawline)                                   | 绘制线条                                                                                                                |
| [UCanvas](/docs/虚幻引擎/api/虚幻c++/engine/canvas类/#ucanvas)                                               | [UCanvas::SizeX 和 UCanvas::SizeY](</docs/虚幻引擎/api/虚幻c++/engine/canvas类/#ucanvas-sizex 和 ucanvas-sizey>)，画布长宽 |
| [TInterval](/docs/虚幻引擎/api/虚幻c++/数据结构/interval模板类/#tinterval)                                   | 模板类，保存区间；[TInterval::Min 和 TInterval::Max](</docs/虚幻引擎/api/虚幻c++/数据结构/interval模板类/#tinterval-min 和 tinterval-max>)，区间端点 |
| [USpringArmComponent::SocketOffset](/docs/虚幻引擎/api/虚幻c++/组件/springarm组件/#uspringarmcomponent-socketoffset) | 设置Camera偏移                                                                                                          |
| [UPrimitiveComponent::SetOwnerNoSee](/docs/虚幻引擎/api/虚幻c++/组件/primitive组件/#uprimitivecomponent-setownernosee) | 设置渲染标志bOwnerNoSee                                                                                                 |

| 虚幻编辑器          |              |                  |
|----------------|--------------|------------------|
| BP_STUBaseCharacter | SpringArm组件 | 设置Camera偏移   |
|                     | TextRender组件 | 设置渲染标志OwnerNoSee |


## 创建AHUD派生类 {#创建ahud派生类}

`虚幻编辑器` <br/>
创建AHUD派生类，绘制我们需要的元素 <br/>

-   Actor &gt; AHUD <br/>
    
    <img src="/pic/武器/绘制瞄准十字/AHUD.png" width="1000" /> <br/> <br/>
-   public <br/>
    
    <img src="/pic/武器/绘制瞄准十字/AHUD-Public.png" width="1000" /> <br/> <br/>


## 绘制瞄准十字 {#绘制瞄准十字}

`虚幻C++` <br/>


### 更新头文件搜索路径 {#更新头文件搜索路径}

`ShootThemUp: ShootThemUp.Build.cs` <br/>

```csharp
PublicIncludePaths.AddRange(new string[] 
{
    "ShootThemUp/Public/Player",
    "ShootThemUp/Public/Components",
    "ShootThemUp/Public/Dev",
    "ShootThemUp/Public/Weapon",
    "ShootThemUp/Public/UI"
});
```


### 设置关卡使用STUGameHUD {#设置关卡使用stugamehud}

`ShootThemUp: STUGameModeBase.cpp` <br/>

```cpp
#include "UI/STUGameHUD.h"

// ASTUGameModeBase
HUDClass = ASTUGameHUD::StaticClass();
```


### 绘制瞄准十字 {#绘制瞄准十字}

暂时的解决方案，之后会使用widget来绘制 <br/>


#### 功能函数DrawCrossHair {#功能函数drawcrosshair}

1.  声明 <br/>
    `private` <br/>
    `ShootThemUp: UI/STUGameHUD.h` <br/>
    ```cpp
    void DrawCrossHair();
    ```
2.  定义 <br/>
    `ShootThemUp: UI/STUGameHUD.cpp` <br/>
    ```cpp
    void ASTUGameHUD::DrawCrossHair() {}
    ```


#### 获取屏幕中心位置 {#获取屏幕中心位置}

通过Canvas成员获取屏幕长和宽，中心点保存在TInterval类型变量里 <br/>
`ShootThemUp: UI/STUGameHUD.cpp`                          <br/>

```cpp
#include "Engine/Canvas.h"

// DrawCrossHair
const TInterval<float> Center(Canvas->SizeX * 0.5f, Canvas->SizeY * 0.5f);
```


#### 绘制瞄准十字 {#绘制瞄准十字}

1.  线条参数 <br/>
    
    |    | -                |
    |----|------------------|
    | 颜色 | LineColor        |
    | 粗细 | LineThickness    |
    | 长度 | HalfLineSize x 2 |
2.  使用AHUD::DrawLine绘制十字 <br/>
    `ShootThemUp: UI/STUGameHUD.cpp`                   <br/>
    ```cpp
    // DrawCorssHair
    
    const float HalfLineSize = 10.0f;
    const float LineThickness = 2.0f;
    const FLinearColor LineColor = FLinearColor::Green;
    
    DrawLine(Center.Min, Center.Max - HalfLineSize, Center.Min, Center.Max + HalfLineSize, LineColor, LineThickness);
    DrawLine(Center.Min - HalfLineSize, Center.Max, Center.Min + HalfLineSize, Center.Max, LineColor, LineThickness);
    ```


#### 覆写基类DrawHUD，调用其基类函数和DrawCorssHair {#覆写基类drawhud-调用其基类函数和drawcorsshair}

1.  声明 <br/>
    `public` <br/>
    `ShootThemUp: UI/STUGameHUD.h` <br/>
    ```cpp
    virtual void DrawHUD() override;
    ```
2.  定义 <br/>
    `ShootThemUp: UI/STUGameHUD.cpp` <br/>
    ```cpp
    void ASTUGameHUD::DrawHUD()
    {
        Super::DrawHUD();
        DrawCrossHair();
    }
    ```


## 查看 {#查看}

`虚幻编辑器`      <br/>


### 关卡使用STUGameHUD {#关卡使用stugamehud}

<img src="/pic/武器/绘制瞄准十字/世界设置-STUGameHUD.png" width="500" /> <br/>      <br/>


### 操控Character移动，或调整屏幕大小，绿色十字总在屏幕中心位置 {#操控character移动-或调整屏幕大小-绿色十字总在屏幕中心位置}

<img src="/pic/武器/绘制瞄准十字/绿色十字.png" width="800" /> <br/> <br/>

看上去是2D效果 <br/>


### 调整Camera组件位置 {#调整camera组件位置}

`BP_STUBaseCharacter，选中SpringArmComponent > Details > Camera > Socket Offset，设置Y偏移100` <br/>

<img src="/pic/武器/绘制瞄准十字/SpringArm-SocketOffset.png" width="1200" /> <br/> <br/>

Camera在Character的右·上·后方，Camera对到瞄准十字 <br/>

<img src="/pic/武器/绘制瞄准十字/效果图.png" width="800" /> <br/> <br/>


### 调整HealthText组件 {#调整healthtext组件}

之后会把生命值显示的逻辑在别处实现 <br/>


#### 隐藏生命值 {#隐藏生命值}

`BP_STUBaseCharacter，选中HealthTextComponent > Details` <br/>

1.  搜索Owner，勾选 `Owner No See` <br/>
    
    | -              |                         |                             |
    |----------------|-------------------------|-----------------------------|
    | Owner No See   | 玩家可以看见他人游戏角色的生命值，看不见自己的 | 渲染别人家的TextComponent，不渲染自家的 |
    | Only Owner See | 每个玩家只能看见自己游戏角色的生命值 | 渲染自家Character的TextComponent |
    
    <img src="/pic/武器/绘制瞄准十字/HealthText-OwnerNoSee.png" width="1000" /> <br/> <br/>
2.  重置文本旋转 <br/>
    
    <img src="/pic/武器/绘制瞄准十字/HealthText-Rotation.png" width="1000" /> <br/> <br/>
    
    看他人生命值时，文本方向ok <br/>
3.  在关卡中临时添加BP_STUBaseCharacter对象，查看效果 <br/>
    
    <img src="/pic/武器/绘制瞄准十字/效果图2.png" width="800" /> <br/> <br/>


## 在代码中设置 {#在代码中设置}

`虚幻C++` <br/>
`ShootThemUp: Player/STUBaseCharacter.cpp` <br/>

1.  设置SpringArm组件socket offset的方法 <br/>
    ```cpp
    // 构造函数
    SpringArmComponent->SocketOffset = FVector(0.0f, 100.0f, 80.0f);
    ```
2.  设置HealthText组件OwnerNoSee标志位的方法 <br/>
    ```cpp
    // 构造函数
    HealthTextComponent->SetOwnerNoSee(true);
    ```

