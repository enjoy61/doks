---
title: "射击伤害"
date: 2023-08-11T18:23:26
lastmod: 2023-08-14T20:48:15+08:00
draft: false
weight: 1008
---

## 说明 {#说明}

从交点获取击中的Actor信息 <br/>


## 创建MakeDamage, 击中目标时调用, 传入相交信息 {#创建makedamage-击中目标时调用-传入相交信息}

`C++` <br/>


### 搭建框架 {#搭建框架}

1.  声明 <br/>
    `preotected` <br/>
    `ShootThemUp: Weapon/STUBaseWeapon.h` <br/>
    ```cpp
    void MakeDamage(const FHitResult& HitResult);
    ```
2.  空定义 <br/>
    `ShootThemUp: Weapon/STUBaseWeapon.cpp` <br/>
    ```cpp
    void ASTUBaseWeapon::MakeDamage(const FHitResult& HitResult) {}
    ```
3.  MakeShot中调用 <br/>
    `ShootThemUp: Weapon/STUBaseWeapon.cpp` <br/>


### 实现MakeDamage {#实现makedamage}

1.  获取击中的Actor <br/>
    `ShootThemUp: Weapon/STUBaseWeapon.cpp`          <br/>
    ```cpp
    const auto DamagedActor = HitResult.GetActor();
    if (!DamagedActor) return;
    ```
2.  添加数据成员: 伤害值 <br/>
    `protected` <br/>
    `ShootThemUp: Weapon/STUBaseWeapon.h` <br/>
    ```cpp
    UPROPERTY(VisibleAnywhere, BlueprintReadWrite)
    float DamageAmount = 10.0f;
    ```
3.  对Actor造成伤害, 直接对其调用TakeDamage <br/>
    ```cpp
    DamagedActor->TakeDamage(DamageAmount, FDamageEvent(), GetPlayerController(), this);
    ```


## 查看 {#查看}

`虚幻编辑器` <br/>

1.  对游戏角色造成射击伤害 <br/>
    
    <img src="/pic/武器/射击伤害/对游戏角色造成射击伤害.png" width="800" /> <br/> <br/>
2.  游戏角色死亡 <br/>
    
    <img src="/pic/武器/射击伤害/射死游戏角色.png" width="800" /> <br/> <br/>


## 角色死亡播放死亡动画倒地, CapsuleComponent成为障碍物 {#角色死亡播放死亡动画倒地-capsulecomponent成为障碍物}

`虚幻编辑器` <br/>

1.  运行时显示CapsuleComponent <br/>
    ```text
    show collision     
    ```
2.  游戏角色死亡, CapsuleComponent成为障碍物 <br/>
    
    <img src="/pic/武器/射击伤害/CapsuleComponent.png" width="800" /> <br/> <br/>


## 死亡处理函数中, 禁止CapsuleComponent的碰撞 {#死亡处理函数中-禁止capsulecomponent的碰撞}

`C++` <br/>
`ShootThemUp: Player/STUBaseCharacter.cpp` <br/>

```cpp
#include "Components/CapsuleComponent.h"

// OnDeath
GetCapsuleComponent()->SetCollisionResponseToAllChannels(ECollisionResponse::ECR_Ignore); // 对所有channel的碰撞反馈统一进行设置
```


## 注意到游戏角色死亡后, 武器还在 {#注意到游戏角色死亡后-武器还在}

`虚幻编辑器` <br/>

<img src="/pic/武器/射击伤害/武器.png" width="800" /> <br/> <br/>

