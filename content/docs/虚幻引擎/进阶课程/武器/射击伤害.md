---
title: "射击伤害"
date: 2023-08-11T18:23:26
lastmod: 2023-08-18T08:44:33+08:00
draft: false
weight: 1008
---

## 概览 {#概览}

-   [X] 击中游戏角色时, 对其造成伤害 <br/>
-   [X] 在代码中设置Capsule组件的碰撞反馈 <br/>


## 搭建框架: 轨迹计算发生碰撞时, 调用MakeDamage, 传入碰撞信息 {#搭建框架-轨迹计算发生碰撞时-调用makedamage-传入碰撞信息}

`C++` <br/>

1.  `ShootThemUp: Weapon/STUBaseWeapon.h` <br/>
    `protected` <br/>
    ```cpp
    void MakeDamage(const FHitResult& HitResult);
    ```
2.  `ShootThemUp: Weapon/STUBaseWeapon.cpp` <br/>
    ```cpp
    void ASTUBaseWeapon::MakeDamage(const FHitResult& HitResult) {}
    ```
3.  在MakeShot中调用MakeDamage <br/>
    `ShootThemUp: Weapon/STUBaseWeapon.cpp` <br/>


## 实现MakeDamage {#实现makedamage}


### 添加数据成员: 固定伤害值 {#添加数据成员-固定伤害值}

`protected` <br/>
`ShootThemUp: Weapon/STUBaseWeapon.h` <br/>

```cpp
UPROPERTY(VisibleAnywhere, BlueprintReadWrite)
float DamageAmount = 10.0f;
```


### 获取碰撞Actor, 对其造成伤害 {#获取碰撞actor-对其造成伤害}

`ShootThemUp: Weapon/STUBaseWeapon.cpp` <br/>

```cpp
const auto DamagedActor = HitResult.GetActor();
if (!DamagedActor) return;

DamagedActor->TakeDamage(DamageAmount, FDamageEvent(), GetPlayerController(), this);
```


## 查看 {#查看}

`虚幻编辑器` <br/>

1.  对游戏角色造成射击伤害 <br/>
    
    <img src="/pic/武器/射击伤害/对游戏角色造成射击伤害.png" width="800" /> <br/> <br/>
2.  游戏角色死亡 <br/>
    
    <img src="/pic/武器/射击伤害/射死游戏角色.png" width="800" /> <br/> <br/>


## 游戏角色死亡后播放死亡动画倒地, 其销毁前, Capsule组件成为障碍物 {#游戏角色死亡后播放死亡动画倒地-其销毁前-capsule组件成为障碍物}

`虚幻编辑器` <br/>

1.  运行时显示Capsule组件 <br/>
    ```text
    show collision     
    ```
2.  游戏角色死亡, 无法穿过竖立着的Capsule组件 <br/>
    
    <img src="/pic/武器/射击伤害/CapsuleComponent.png" width="800" /> <br/> <br/>


## 游戏角色死亡后, 设置所有碰撞通道忽略Capsule组件 {#游戏角色死亡后-设置所有碰撞通道忽略capsule组件}

`C++` <br/>
`ShootThemUp: Player/STUBaseCharacter.cpp` <br/>

```cpp
#include "Components/CapsuleComponent.h"

// OnDeath
GetCapsuleComponent()->SetCollisionResponseToAllChannels(ECollisionResponse::ECR_Ignore); // 对所有channel的碰撞反馈统一进行设置
```


## 游戏角色死亡后, 武器还在 {#游戏角色死亡后-武器还在}

`虚幻编辑器` <br/>

<img src="/pic/武器/射击伤害/武器.png" width="800" /> <br/> <br/>

