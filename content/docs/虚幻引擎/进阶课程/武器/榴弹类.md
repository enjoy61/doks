---
title: "榴弹类"
date: 2023-08-22T19:48:41
lastmod: 2023-11-01T20:07:51+08:00
draft: false
weight: 2013
---

## 说明 {#说明}

-   榴弹发射器 `Grenade Launcher` 发射榴弹 <br/>
-   榴弹没有对应网格体，也不属于某个粒子系统 `Particle System` <br/>


## 概览 {#概览}

-   [X] 为榴弹发射器网格体添加MuzzleSocket <br/>
-   [X] 创建榴弹类, 为其添加球体组件 <br/>
-   [X] 初始化STULauncherWeapon; 发射时, 动态生成榴弹对象 <br/>
-   [X] 创建基于榴弹类的蓝图类 <br/>
-   [X] 创建用于榴弹类的材质类和材质实例类 <br/>


## 球体组件 {#球体组件}

`USphereComponent` `Spherical Collision` <br/>
`UCapsuleComponent` `Capsule Collision` <br/>

-   外形是球， 提供碰撞功能 <br/>
-   球体组件的碰撞相较Capsule组件的碰撞更为简单 <br/>


## 为网格体Launcher添加MuzzleSocket {#为网格体launcher添加muzzlesocket}

`虚幻编辑器` <br/>

1.  打开Contents/ExternalContent/Weapon/Weapons/Launcher <br/>
2.  选中LauncherRoot, 右键, 选择Add Socket <br/>
3.  选中Socket, 去到Details页面, 进行设置 <br/>
    
    | -          |              |
    |------------|--------------|
    | SocketName | MuzzleSocket |
    | Location   | (0, -15, 65) |
    | Rotation   | (-90, 90, 0) |
    
    **图示Relative Rotation &gt; Y错误: 应为90, 失误填成9** <br/>
    
    <img src="/pic/武器/榴弹类/MuzzleSocketDetails.png" width="1200" /> <br/> <br/>


## 创建榴弹类 {#创建榴弹类}


### 创建C++类STUProjectile {#创建c-plus-plus-类stuprojectile}

`虚幻编辑器` <br/>
Tools &gt; New C++ Class.. <br/>

| -    |               |
|------|---------------|
| 基类 | Actor         |
| 上级目录 | Weapon        |
| 访问属性 | Public        |
| 类名 | STUProjectile |


### 调整框架 {#调整框架}

`C++` <br/>

1.  每帧调用false <br/>
2.  无Tick <br/>

`ShootThemUp: Weapon/STUProjectile.h`          <br/>
`ShootThemUp: Weapon/STUProjectile.cpp` <br/>


### 添加球体组件, 提供碰撞功能 {#添加球体组件-提供碰撞功能}

`C++` <br/>

1.  添加组件 <br/>
    `protected` <br/>
    `ShootThemUp: Weapon/STUProjectile.h` <br/>
    ```cpp
    class USphereComponent;
    
    UPROPERTY(VisibleDefaultsOnly)
    USphereComponent *CollisionComponent;
    ```
2.  初始化组件: 碰撞半径为5, 设为根组件 <br/>
    `ShootThemUp: Weapon/STUProjectile.cpp` <br/>
    ```cpp
    #include "Components/SphereComponent.h"
    
    // Constructor
    
    CollisionComponent = CreateDefaultSubobject<USphereComponent>("SphereComponent");
    
    // set collision radius
    CollisionComponent->InitSphereRadius(5.0f);
    
    SetRootComponent(CollisionComponent);
    ```


## 初始化STULauncherWeapon {#初始化stulauncherweapon}

覆写虚函数FireStart和MakeShot <br/>

1.  `ShootThemUp: Weapon/STULauncherWeapon.h` <br/>
    ```cpp
    // public
    virtual void FireStart() override;
    
    // protected
    virtual void MakeShot() override;
    ```
2.  在FireStart中调用MakeShot <br/>
    `ShootThemUp: Weapon/STULauncherWeapon.cpp` <br/>
    ```cpp
    void ASTULauncherWeapon::FireStart()
    {
        MakeShot();
    }
    
    void ASTULauncherWeapon::MakeShot()
    { }
    ```


## 榴弹发射器发射榴弹时, 动态生成榴弹对象 {#榴弹发射器发射榴弹时-动态生成榴弹对象}


### 添加榴弹类属性 {#添加榴弹类属性}

`protected` <br/>
`ShootThemUp: Weapon/STULauncherWeapon.h` <br/>

```cpp
class ASTUProjectile;

UPROPERTY(EditDefaultsOnly, BlueprintReadWrite)
TSubclassOf<ASTUProjectile> ProjectileClass;
```


### 在MakeShot动态创建榴弹对象 {#在makeshot动态创建榴弹对象}

1.  榴弹初始位置在枪口 <br/>
2.  之后需要对榴弹进行参数配置, 延后调用BeginPlay <br/>

`ShootThemUp: Weapon/STULauncherWeapon.cpp` <br/>

```cpp
#include "Weapon/STUProjectile.h"
#include "Kismet/GameplayStatics.h"
#include "Engine/World.h"

void ASTULauncherWeapon::MakeShot()
{
    const FTransform SpawnTransform(FRotator::ZeroRotator, GetMuzzleWorldLocation());
    auto Projectile = UGameplayStatics::BeginDeferredActorSpawnFromClass(GetWorld(), ProjectileClass, SpawnTransform);
    // 设置榴弹参数
    UGameplayStatics::FinishSpawningActor(Projectile, SpawnTransform);
}
```


## 创建基于STUProjectile的蓝图类 {#创建基于stuprojectile的蓝图类}

`虚幻编辑器` <br/>

1.  选中C++ Classed &gt; ShootThemUp &gt; Public &gt; Weapon &gt; STUProjectile, 右键, 选择Create Blueprint class based on STUProjectile <br/>
2.  命名为BP_STUProjectile, 保存到Content/Weapon <br/>


### 查看BP_STUProjectile {#查看bp-stuprojectile}

有CollisionComponent <br/>

<img src="/pic/武器/榴弹类/SphereComponent.png" width="500" /> <br/> <br/>


### 添加静态网格体组件 {#添加静态网格体组件}

1.  点击Add, 搜索Sphere, 选择Basic Shapes &gt; Sphere <br/>
    
    <img src="/pic/武器/榴弹类/AddSphere.png" width="300" /> <br/> <br/>
2.  选中Sphere, 去到细节面板, 设置缩放属性, 与碰撞大小匹配 <br/>
    
    | -                    |                       |
    |----------------------|-----------------------|
    | Transfrom &gt; Scale | (0.095, 0.095, 0.095) |
    
    <img src="/pic/武器/榴弹类/SphereScale.png" width="1500" /> <br/> <br/>


## 设置BP_STULauncherWeapon的榴弹类属性为BP_STUProjectile {#设置bp-stulauncherweapon的榴弹类属性为bp-stuprojectile}

<img src="/pic/武器/榴弹类/ProjectileClass.png" width="600" /> <br/> <br/>


## 为榴弹类应用材质 {#为榴弹类应用材质}


### 创建材质类 {#创建材质类}

1.  创建文件夹Content/Materials <br/>
2.  在材质目录创建材质类 <br/>
    
    <img src="/pic/武器/榴弹类/CreateMaterial.png" width="500" /> <br/> <br/>
3.  命名为M_BaseColor <br/>
    
    <img src="/pic/武器/榴弹类/M_BaseColor.png" width="500" /> <br/> <br/>


### 设置材质类 {#设置材质类}

1.  双击打开M_BaseColor <br/>
2.  在Material Graph空白处点击鼠标左键, 同时按下数字4, 创建四维常量, 作为Base Color的输入 <br/>
    
    <img src="/pic/武器/榴弹类/InputOfBaseColor.png" width="600" /> <br/> <br/>
3.  右键四维常量, 将其转换为参数, 命名为Color <br/>
    
    <img src="/pic/武器/榴弹类/convert.png" width="450" /> <br/> <br/>


### 创建材质实例类 {#创建材质实例类}

1.  选中M_BaseColor, 右键 <br/>
    
    <img src="/pic/武器/榴弹类/CreateMI.png" width="500" /> <br/> <br/>
2.  命名为MI_RedColor <br/>


### 配置材质实例类 {#配置材质实例类}

1.  双击打开MI_RedColor <br/>
2.  在细节面板勾选Color参数 <br/>
    
    <img src="/pic/武器/榴弹类/MIColor.png" width="500" /> <br/> <br/>
    
    <img src="/pic/武器/榴弹类/CheckColor.png" width="500" /> <br/> <br/>
3.  设置Color参数 <br/>
    
    <img src="/pic/武器/榴弹类/ColorValue.png" width="500" /> <br/> <br/>


### 为BP_STUProjectile设置材质 {#为bp-stuprojectile设置材质}

1.  选择Sphere <br/>
2.  去到Details &gt; Materials, 设置Element 0 <br/>
    
    <img src="/pic/武器/榴弹类/SetMaterials.png" width="500" /> <br/> <br/>


## 查看 {#查看}

点击鼠标左键射击, 榴弹发射器发射红色小球 <br/>

<img src="/pic/武器/榴弹类/LauncherFire.png" width="1000" /> <br/> <br/>

