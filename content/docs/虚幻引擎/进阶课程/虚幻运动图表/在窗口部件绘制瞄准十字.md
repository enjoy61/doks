---
title: "在窗口部件绘制瞄准十字"
date: 2023-10-07T17:45:18
lastmod: 2023-10-08T01:40:47+08:00
draft: false
weight: 2004
---

## 概览 {#概览}

-   [X] 获取并导入素材 <br/>
-   [X] 在窗口部件中添加瞄准十字图片 <br/>
-   [X] 窗口部件实现接口返回当前武器图片 <br/>
-   [X] 在窗口部件中实现逻辑加载图片 <br/>


## 获取素材 {#获取素材}

`ShooterGame` <br/>
选中Conent/UI/HUD/HUDMain <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/HUDMain.png" width="700" /> <br/> <br/>

右键 <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/Export.png" width="700" /> <br/> <br/>

裁剪武器图标和对应的十字瞄准线, 命名并保存到Image文件夹 <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/Image.png" width="500" /> <br/> <br/>


## 导入素材 {#导入素材}

`ShootThemUp` <br/>
将Image文件夹拖入到Content/UI下, 虚幻引擎自动将图片转换成资产 <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/image-in-content.png" width="700" /> <br/> <br/>

所有的外部资源, 如图片, 音频, 导入时均会被转换为资产格式. 这样, 在不同平台打包时更便利 <br/>

本节课使用瞄准十字图片, 武器图标供下节课使用 <br/>


## 在窗口部件中添加瞄准十字图片 {#在窗口部件中添加瞄准十字图片}

`WBP_PlayerHUD` <br/>


### 从选项板中, 将图片元素拖入到视口 {#从选项板中-将图片元素拖入到视口}

`Palette > Image` <br/>

可以在视口中调整图片大小 <br/>


### 选择测试图片 {#选择测试图片}

`Details > Appearance > Brush > Image` <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/set-image.png" width="400" /> <br/> <br/>

选择RifleCrossHair <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/wbp-测试.png" width="400" /> <br/> <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/wbp-测试展示.png" width="1000" /> <br/> <br/>


### 使用图片原大小 {#使用图片原大小}

勾选 `Details > Slot > Size To Content` <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/默认大小.png" width="1000" /> <br/> <br/>


### 使图片居中 {#使图片居中}

-   添加锚 <br/>
    `Details > Slot(Canvas Panel Slot) > Anchors` , 选择居中项 <br/>
    
    <img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/锚居中.png" width="400" /> <br/> <br/>
-   设置图片位置 <br/>
    `Details > Slot` , 设置Position X = Position Y = 0 <br/>
    
    <img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/图片位置.png" width="400" /> <br/> <br/>
-   设置对齐 <br/>
    `Details > Slot` , 设置Alignment X = Y = 0.5 <br/>
    
    <img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/对齐.png" width="400" /> <br/> <br/>


### 测试结果 {#测试结果}

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/wbp-测试结果.png" width="1000" /> <br/> <br/>


## 窗口部件类实现接口返回武器图片 {#窗口部件类实现接口返回武器图片}


### 添加数据结构: 存放相应图片 {#添加数据结构-存放相应图片}

存放武器对应的图标和瞄准十字 <br/>
使用 `UTexture2D` 类型保存纹理 <br/>
`CoreTypes.h` <br/>

```cpp
class UTexture2D;
// weapon
USTRUCT(BlueprintType)
struct FWeaponUIData
{
    GENERATED_USTRUCT_BODY()

    UPROPERTY(EDitDefaultsOnly, BlueprintReadWrite)
    UTexture2D *MainIcon;

    UPROPERTY(EDitDefaultsOnly, BlueprintReadWrite)
    UTexture2D *CrossHairIcon;
};
```


### 添加数据成员: 存放武器相关图片 {#添加数据成员-存放武器相关图片}

`ShootThemUp: Weapon/STUBaseWeapon.h` <br/>
`protected` <br/>

```cpp
UPROPERTY(EDitDefaultsOnly, BlueprintReadWrite)       
FWeaponUIData UIData;
```


### 添加接口: 获取武器相关图片 {#添加接口-获取武器相关图片}

`ShootThemUp: Weapon/STUBaseWeapon.h`      <br/>
`public` <br/>

```cpp
FWeaponUIData GetUIData() const { return UIData; }
```


### 添加接口: 获取当前武器相关图片 {#添加接口-获取当前武器相关图片}

`Wrapper Function` <br/>
`ShootThemUp: Components/STUWeaponComponent.h` <br/>
`pulic` <br/>

```cpp
bool GetWeaponUIData(FWeaponUIData &UIData) const;
```

`ShootThemUp: Components/STUWeaponComponent.cpp` <br/>

```cpp
bool USTUWeaponComponent::GetWeaponUIData(FWeaponUIData &UIData) const
{
    if (CurrentWeapon)
    {
        UIData = CurrentWeapon->GetUIData();
        return true;
    }
    return false;
}
```


### 添加接口: 窗口部件类提供接口获取武器图片信息 {#添加接口-窗口部件类提供接口获取武器图片信息}

`ShootThemUp: UI/STUPlayerHUDWidget.h` <br/>
`public` <br/>

```cpp
#include "STUCoreTypes.h"

UFUNCTION(BlueprintCallable)
bool GetWeaponUIData(FWeaponUIData &UIData) const;
```

`ShootThemUp: UI/STUPlayerHUDWidget.cpp` <br/>

```cpp
#include "Components/STUWeaponComponent.h"

bool USTUPlayerHUDWidget::GetWeaponUIData(FWeaponUIData &UIData) const
{
    const auto Player = GetOwningPlayerPawn();
    if (!Player) return false;

    const auto Component = Player->GetComponentByClass(USTUWeaponComponent::StaticClass());
    const auto WeaponComponent = Cast<USTUWeaponComponent>(Component);
    if (!WeaponComponent) return false;

    return WeaponComponent->GetWeaponUIData(UIData);
}
```


### 屏蔽之前绘制瞄准十字逻辑 {#屏蔽之前绘制瞄准十字逻辑}

`ShootThemUp: UI/STUGameHUD.cpp` <br/>

屏蔽DrawHUD中对DrawCrossHair的调用 <br/>


## 设置瞄准图片 {#设置瞄准图片}


### 配置步枪和发射器图片 {#配置步枪和发射器图片}

`BP_STURifleWeapon` <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/配置步枪.png" width="800" /> <br/> <br/>

`BP_STULauncherWeapon` <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/配置发射器.png" width="800" /> <br/> <br/>


### 获取瞄准十字图片 {#获取瞄准十字图片}

`WBP_PlayerHUD` <br/>


#### 添加函数: 获取瞄准十字图片 {#添加函数-获取瞄准十字图片}

-   `Image > Details > Brush > Bind > Create Binding` <br/>
    
    <img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/添加bind.png" width="1000" /> <br/> <br/>
-   重命名为 `Get Crosshair Image` <br/>
    
    <img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/重命名get-crosshair-image.png" width="1000" /> <br/> <br/>


#### 添加节点: 获取武器图片 {#添加节点-获取武器图片}

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/add-node-get-weapon-uidata.png" width="400" /> <br/> <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/get-weapon-uidata.png" width="300" /> <br/> <br/>

展开UIData针脚 <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/split-pin.png" width="400" /> <br/> <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/get-weapon-uidata-2.png" width="300" /> <br/> <br/>


#### 添加节点: 根据返回值做不同处理 {#添加节点-根据返回值做不同处理}

空白处左键同时按下 `B` <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/branch.png" width="200" /> <br/> <br/>

输入来自 `GetWeaponUIData` 返回值 <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/use-branch.png" width="500" /> <br/> <br/>


#### 添加节点: 绘制图片 {#添加节点-绘制图片}

从 `Return Node` 的 `Return Value` 出发, 添加 `Widget > Make Slate Bruch` <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/add-node-make-slatebrush.png" width="500" /> <br/> <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/make-slatbrush.png" width="500" /> <br/> <br/>

<!--list-separator-->

-  设置图片

    从 `GetWeaponUIData > UIData CrossHair Icon` 到 `MakeSlatBrush > Image` <br/>

<!--list-separator-->

-  设置图片绘制大小为图片原大小

    <!--list-separator-->
    
    -  添加节点: 创建Vector2D
    
        从 `MakeSlatBruch > ImageSize` 出发, 添加 `MakeVector2D` <br/>
        
        <img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/add-node-make-vector-2d.png" width="400" /> <br/> <br/>
    
    <!--list-separator-->
    
    -  设置数组
    
        从 `GetWeaponUIData > UIData CrossHair Icon` 出发, 添加 `Rendering > Texture > GetSizeX和GetSizeY` <br/>
        
        <img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/get-size-x-y.png" width="500" /> <br/> <br/>
        
        组合成Vector2D <br/>
        
        GetSizeX和GetSizeY返回整数, 自动转换为浮点数 <br/>


#### 完整处理 {#完整处理}

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/final.png" width="800" /> <br/> <br/>


## 查看 {#查看}

步枪瞄准十字 <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/rifle-show.png" width="1000" /> <br/> <br/>

发射器瞄准十字 <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/launcher-show.png" width="1000" /> <br/> <br/>

角色死亡时, 瞄准十字变为方块, 此时未获取到图片 <br/>

<img src="/pic/虚幻运动图表/在窗口部件绘制瞄准十字/die-show.png" width="1000" /> <br/> <br/>


## 调节光线 {#调节光线}

`4.27` <br/>
`World outliner > Sky Sphere > Details` <br/>

-   `Default > Directional Light Actor > Clear` <br/>
-   `Override Settings > Sun Height = -1` <br/>

