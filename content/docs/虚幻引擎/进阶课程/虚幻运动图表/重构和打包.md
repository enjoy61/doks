---
title: "重构和打包"
date: 2023-10-09T04:19:50
lastmod: 2023-10-09T04:19:52+08:00
draft: false
weight: 2007
---

## 重构 {#重构}


### 实现模板函数: 获取Pawn组件 {#实现模板函数-获取pawn组件}


#### 添加头文件 {#添加头文件}

`Public/STUUtil.h` <br/>

```cpp
#pragma

class APawn;

class STUUtils
{
public:
    template<typename T>
    static T* GetSTUPlayerComponent(APawn *PlayerPawn)
    {
        if (!PlayerPawn) return nullptr;

        const auto Component = PlayerPawn->GetComponentByClass(T::StaticClass());
        return Cast<T>(Component);
    }
};
```


#### 修改获取Pawn组件的地方 {#修改获取pawn组件的地方}

`ShootThemUp: UI/STUPlayerHUDWidget.cpp` <br/>

```cpp
#include "STUUtils.h"

// GetHealthPercent, IsPlayerAlive
const auto HealthComponent = STUUtils::GetSTUPlayerComponent<USTUHealthComponent>(GetOwningPlayerPawn());

// GetCurrentWeaponUIData, GetCurrentWeaponAmmoData
const auto WeaponComponent = STUUtils::GetSTUPlayerComponent<USTUWeaponComponent>(GetOwningPlayerPawn());
```


#### 屏蔽GetWeaponComponent和GetHealthComponent {#屏蔽getweaponcomponent和gethealthcomponent}

`ShootThemUp: UI/STUPlayerHUDWidget.cpp` <br/>
定义 <br/>

`ShootThemUp: UI/STUPlayerHUDWidget.h` <br/>
屏蔽USTUWeaponCOmponent和USTUHealthComponent的前向声明 <br/>
屏蔽GetWeaponComponent和GetHealthComponent <br/>


### 屏蔽弹药日志 {#屏蔽弹药日志}

`ShootThemUp: Weapon/STUBaseWeapon.cpp` <br/>
`DecreaseAmmo` <br/>


## 修改生命值百分比和武器信息颜色 {#修改生命值百分比和武器信息颜色}

`WBP_PlayerHUD` <br/>


### 进度条 {#进度条}

移动到左下角; 修改颜色 <br/>

<img src="/pic/虚幻运动图表/重构和打包/progress-bar.png" width="1000" /> <br/> <br/>


### 文本框 {#文本框}

修改颜色 <br/>

<img src="/pic/虚幻运动图表/重构和打包/text.png" width="1000" /> <br/> <br/>


### 武器图标 {#武器图标}

进入到 `GetWeaponIcon` <br/>

`MakeSlateBrush` , 展开Tint针脚; 修改颜色 <br/>

<img src="/pic/虚幻运动图表/重构和打包/weapon-icon.png" width="1000" /> <br/> <br/>


### 修改元素名 {#修改元素名}

<img src="/pic/虚幻运动图表/重构和打包/element-name.png" width="300" /> <br/> <br/>


## 打包 {#打包}

<img src="/pic/虚幻运动图表/重构和打包/package.png" width="800" /> <br/> <br/>

