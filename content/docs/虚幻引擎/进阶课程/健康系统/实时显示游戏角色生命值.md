---
title: "实时显示游戏角色生命值"
date: 2023-06-11T05:31:13
lastmod: 2023-08-06T23:15:53+08:00
draft: false
weight: 1001
---

## 概览 {#概览}

| -    |                     |         |
|------|---------------------|---------|
| 健康组件 | ActorComponent      | 自定义，纯逻辑 |
| 文本组件 | TextRenderComponent | 显示生命值 |


## 创建健康组件 {#创建健康组件}


### 创建Component/STUHealthComponent {#创建component-stuhealthcomponent}

`虚幻编辑器`       <br/>

-   `ActorComponent` <br/>
    
    <img src="/pic/健康系统/在Character上方显示生命值/创建派生自ActorComponent的C++类/创建C++类-ActorComponent.png" width="800" /> <br/> <br/>
-   `公有类` <br/>
    
    <img src="/pic/健康系统/在Character上方显示生命值/创建派生自ActorComponent的C++类/创建C++类-STUHealthComponent.png" width="800" /> <br/> <br/>


### 调整健康组件框架 {#调整健康组件框架}

`C++` <br/>
`ShootThemUp: Components/STUHealthComponent.h` <br/>
`ShootThemUp: Components/STUHealthComponent.cpp` <br/>

| -             |                               |
|---------------|-------------------------------|
| 默认构造函数  | 将每帧调用TickComponent函数标志置为false |
| BeginPlay     |                               |
| TickComponent | 屏蔽，使用基类实现            |


### 实现 {#实现}


#### 添加生命值上限 {#添加生命值上限}

`protected` <br/>
`ShootThemUp: Components/STUHealthComponent.h` <br/>

```cpp
UPROPERTY(EditDefaultsOnly, meta = (ClampMin = "0.0", ClampMax = "1000.0"))
float MaxHealth = 100.0f;	
```


#### 添加生命值 {#添加生命值}

`private` <br/>
`ShootThemUp: Components/STUHealthComponent.h`        <br/>

```cpp
float Health = 0.0f;
```


#### 初始化生命值 {#初始化生命值}

`ShootThemUp: Components/STUHealthComponent.cpp` <br/>

```cpp
// BeginPlay
Health = MaxHealth;
```


#### 添加接口，返回生命值 {#添加接口-返回生命值}

`public` <br/>
`ShootThemUp: Components/STUHealthComponent.h` <br/>

```cpp
UFUNCTION(BlueprintCallable)
float GetHealth() const { return Health; }
```


## 为游戏角色添加健康组件 {#为游戏角色添加健康组件}

`C++` <br/>

1.  添加STUHealthComponent类型成员 <br/>
    `ShootThemUp: Player/STUBaseCharacter.h` <br/>
    ```cpp
    class USTUHealthComponent;
    
    // protected
    UPROPERTY(VisibleAnywhere, BlueprintReadWrite)
    USTUHealthComponent *HealthComponent;
    ```
2.  初始化组件: STUHealthComponent无表示，不用设置上级组件 <br/>
    `ShootThemUp: Player/STUBaseCharacter.cpp` <br/>
    ```cpp
    #include "Components/STUHealthComponent.h"
    
    // 构造函数
    HealthComponent = CreateDefaultSubobject<USTUHealthComponent>("HealthComponent");
    ```


## 为游戏角色添加文本组件 {#为游戏角色添加文本组件}

`C++` <br/>

1.  添加UTextRenderComponent类型成员 <br/>
    `ShootThemUp: Player/STUBaseCharacter.h` <br/>
    ```cpp
    class UTextRenderComponent;
    
    // protected
    UPROPERTY(VisibleAnywhere, BlueprintReadWrite)
    UTextRenderComponent *HealthTextComponent;	
    ```
2.  初始化组件 <br/>
    `ShootThemUp: Player/STUBaseCharacter.cpp` <br/>
    ```cpp
    #include "Components/TextRenderComponent.h"
    
    // 构造函数
    HealthTextComponent = CreateDefaultSubobject<UTextRenderComponent>("HealthTextComponent");
    HealthTextComponent->SetupAttachment(GetRootComponent());
    ```
3.  每帧更新HealthTextComponent文本 <br/>
    `ShootThemUp: Player/STUBaseCharacter.cpp`         <br/>
    ```cpp
    // Tick
    HealthTextComponent->SetText(FText::FromString(FString::Printf(TEXT("%.0f"), HealthComponent->GetHealth())));
    ```


## 检查组件是否成功初始化 {#检查组件是否成功初始化}

使用IDE编译时，若运行游戏崩溃，可在IDE中查看断点 <br/>
`ShootThemUp: Player/STUBaseCharacter.cpp`      <br/>

```cpp
// BeginPlay
check(HealthComponent);
check(HealthTextComponent);
```


## 调整文本组件 {#调整文本组件}

`虚幻编辑器` <br/>
`BP_STUBaseCharacter` <br/>


### 查看组件 {#查看组件}

<img src="/pic/健康系统/在Character上方显示生命值/调整TextRender组件/BP_STUBaseCharacter-组件列表.png" width="350" /> <br/> <br/>

HealthComponent和CharacterMovement无层级：二者均无表示，纯逻辑；创建后无需挂在其他组件下面 <br/>


### 查看HealthComponent {#查看healthcomponent}

<img src="/pic/健康系统/在Character上方显示生命值/调整TextRender组件/Health组件.png" width="300" /> <br/> <br/>


### 调整TextRender组件 {#调整textrender组件}

<img src="/pic/健康系统/在Character上方显示生命值/调整TextRender组件/TextRender.png" width="1300" /> <br/> <br/>

| -                    |                 |                              |
|----------------------|-----------------|------------------------------|
| Tranform             | Z: 100 Yaw: 180 | 第三视角：运行时摄像机对着 `Character` 背面 |
| Text                 | 0               | 默认值                       |
| Horizontal Alignment | Center          | 水平对齐                     |
| Text Render Color    | 深蓝色          | 文本颜色                     |

<img src="/pic/健康系统/在Character上方显示生命值/调整TextRender组件/TextRender-设置.png" width="450" /> <br/>      <br/>


### 效果图 {#效果图}

<img src="/pic/健康系统/在Character上方显示生命值/调整TextRender组件/效果图.png" width="800" /> <br/> <br/>

