---
title: "为游戏角色绑定模型"
date: 2023-06-11T06:15:23
lastmod: 2023-08-05T18:57:16+08:00
draft: false
weight: 1004
---

## 概览 {#概览}

| -         |                                                       |
|-----------|-------------------------------------------------------|
| 玩家控制的游戏角色 | Character                                             |
| 游戏角色控制器 | PlayerController                                      |
| 关卡设置  | GameModeBase: DefaultPawnClass, PlayerControllerClass |
| 第三视角  | CameraComponent                                       |


## 创建Character类和PlayController类 {#创建character类和playcontroller类}

`虚幻编辑器` <br/>

1.  创建 `Player/STUBaseCharacter` <br/>
    -   `ACharacter` <br/>
        
        <img src="/pic/角色和动画/为Character绑定模型/创建派生自ACharacter的C++类/C++Classes-Player-STUBaseCharacter.png" width="800" /> <br/> <br/>
    -   `公有类` <br/>
        
        <img src="/pic/角色和动画/为Character绑定模型/创建派生自ACharacter的C++类/C++Classes-Player-STUBaseCharacter-Public.png" width="800" /> <br/> <br/>
2.  创建 `Player/STUPlayerController` <br/>
    -   `APlayerController` <br/>
        
        <img src="/pic/角色和动画/为Character绑定模型/创建派生自ACharacter的C++类/C++Classes-Player-STUPlayerController.png" width="800" /> <br/> <br/>
    -   `公有类` <br/>


## 设置头文件搜索路径 {#设置头文件搜索路径}

-   源文件路径已包含上级文件夹 <br/>
    `ShootThemUp: Player/STUBaseCharacter.cpp` <br/>
    
    <img src="/pic/角色和动画/为Character绑定模型/设置STUGameModeBase/头文件路径.png" width="500" /> <br/> <br/>
-   设置头文件搜索路径之后，可以不指明上级文件夹 <br/>
    `ShootThemUp: ShootThemUp.Build.cs` <br/>
    ```csharp
    PublicIncludePaths.AddRange(new string[] { "ShootThemUp/Public/Player" });
    ```


## 设置STUGameModeBase使用STUBaseCharacter和STUPlayController {#设置stugamemodebase使用stubasecharacter和stuplaycontroller}

`C++` <br/>

| -                     |           |
|-----------------------|-----------|
| DefaultPawnClass      | 游戏角色类型 |
| PlayerControllerClass | 游戏角色控制器类型 |

1.  添加默认构造函数声明 <br/>
    `ShootThemUp: STUGameModeBase.h` <br/>
2.  设置默认游戏角色类型和游戏角色控制器类型 <br/>
    `ShootThemUp: STUGameModeBase.cpp` <br/>
    ```cpp
    #include "Player/STUBaseCharacter.h"
    #include "Player/STUPlayerController.h"
    
    // 以下亦正确
    // #include "STUBaseCharacter.h"
    // #include "STUPlayerController.h"
    
    ASTUGameModeBase::ASTUGameModeBase()
    {
        DefaultPawnClass = ASTUBaseCharacter::StaticClass();
        PlayerControllerClass = ASTUPlayerController::StaticClass();
    }
    ```


## 为游戏角色添加第三视角 {#为游戏角色添加第三视角}

`C++` <br/>
为STUBaseCharacter添加UCameraComponent类型成员 <br/>

1.  添加CameraComponent类型成员 <br/>
    `ShootThemUp: Player/STUBaseCharacter.h` <br/>
    ```cpp
    // 前向声明
    class UCameraComponent;
    
    // protected
    UPROPERTY(VisibleAnywhere, BlueprintReadWrite)
    UCameraComponent *CameraComponent;
    ```
2.  初始化组件 <br/>
    `ShootThemUp: Player/STUBaseCharacter.cpp` <br/>
    ```cpp
    #include "Camera/CameraComponent.h"
    
    // 默认构造函数
    CameraComponent = CreateDefaultSubobject<UCameraComponent>("CameraComponent");
    CameraComponent->SetupAttachment(GetRootComponent());
    ```
3.  编译ShootThemUp <br/>


## 设置关卡使用蓝图类 {#设置关卡使用蓝图类}

`虚幻编辑器` <br/>


### 查看STUGameModeBase使用的类型 {#查看stugamemodebase使用的类型}

<img src="/pic/角色和动画/为Character绑定模型/设置BP_STUBaseCharacter/WorldSettings-STUGameModeBase.png" width="400" /> <br/> <br/>


### 创建基于STUGameModeBase的蓝图类 {#创建基于stugamemodebase的蓝图类}

1.  `选中C++ Classes/ShootThemUp/STUGameModeBase右键, 选择Create blueprint class based on STUGameModeBase` <br/>
2.  保存到Content/, 命名为BP_STUBaseGameBase <br/>
    
    <img src="/pic/角色和动画/为Character绑定模型/设置BP_STUBaseCharacter/创建BP_STUGameModeBase.png" width="1000" /> <br/> <br/>


### 创建基于STUBaseCharacter和STUPlayerController的蓝图类 {#创建基于stubasecharacter和stuplayercontroller的蓝图类}

1.  创建 `Content/Player` 文件夹 <br/>
2.  创建 `BP_STUBaseCharacter` 和 `BP_STUPlayerController` , 保存到 `Content/Player/` <br/>
    
    <img src="/pic/角色和动画/为Character绑定模型/设置BP_STUBaseCharacter/ContentBrowser-Content-Player.png" width="400" /> <br/> <br/>


### 设置关卡使用BP_STUGameModeBase, 并设置BP_STUGameModeBase使用BP_STUBaseCharacter和BP_STUPlayerController {#设置关卡使用bp-stugamemodebase-并设置bp-stugamemodebase使用bp-stubasecharacter和bp-stuplayercontroller}

<img src="/pic/角色和动画/为Character绑定模型/设置BP_STUBaseCharacter/WorldSettings-BP.png" width="400" /> <br/> <br/>


## 为游戏角色绑定模型 {#为游戏角色绑定模型}

`虚幻编辑器` <br/>
`BP_STUBaseCharacter` <br/>


### 查看组件信息 {#查看组件信息}

<img src="/pic/角色和动画/为Character绑定模型/设置BP_STUBaseCharacter/BP_STUBaseCharacter-Component.png" width="350" /> <br/> <br/>

|                    | 说明                 |
|--------------------|--------------------|
| Capsule Component  | 根组件，实现碰撞检测 |
| Arrow Component    | 角色的前进方向       |
| Camera Component   | 第三视角             |
| Mesh               | 骨骼网格体(Skeletal Mesh) |
| Character Movement | 纯逻辑组件，负责游戏角色运动 |


### 设置蓝图类编译成功自动保存 {#设置蓝图类编译成功自动保存}

<img src="/pic/角色和动画/为Character绑定模型/设置BP_STUBaseCharacter/编译成功自动保存.png" width="450" /> <br/> <br/>


### 为Mesh组件绑定骨骼网格体 {#为mesh组件绑定骨骼网格体}

1.  `Mesh` 绑定 `HeroTPP` <br/>
    
    <img src="/pic/角色和动画/为Character绑定模型/设置BP_STUBaseCharacter/BP_STUBaseCharacter-Mesh-HeroTPP-Lookup.png" width="1400" /> <br/> <br/>
2.  材质自动应用 `HeroTPP` <br/>
    
    <img src="/pic/角色和动画/为Character绑定模型/设置BP_STUBaseCharacter/BP_STUBaseCharacter-Mesh-HeroTPP.png" width="1400" /> <br/> <br/>
3.  移动模型到合适位置，旋转模型与前进方向一致 <br/>
    
    <img src="/pic/角色和动画/为Character绑定模型/设置BP_STUBaseCharacter/BP_STUBaseCharacter-Mesh.png" width="1400" /> <br/> <br/>
4.  实现第三视角 <br/>
    分离 `Camera Component` 和 `Mesh` 组件 <br/>
    
    <img src="/pic/角色和动画/为Character绑定模型/设置BP_STUBaseCharacter/分离Camera和Mesh.png" width="1400" /> <br/> <br/>
5.  效果图 <br/>
    
    <img src="/pic/角色和动画/为Character绑定模型/设置BP_STUBaseCharacter/效果图.png" width="800" /> <br/> <br/>

