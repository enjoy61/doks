---
title: "为游戏角色添加向前走路动画"
date: 2023-06-11T06:17:31
lastmod: 2023-08-06T10:33:39+08:00
draft: false
weight: 1007
---

## 概览 {#概览}

`虚幻编辑器` <br/>
动画随着游戏角色的运动速度而变化 <br/>


### brush {#brush}

最简单的可编辑几何体，我们可以修改其顶点位置，调整其他参数，然后将其转换成静态网格体 <br/>


### CharacterMovementComponent {#charactermovementcomponent}

负责 `Character` 运动，其各种属性均和 `Character` 运动有关 <br/>


### 动画蓝图 {#动画蓝图}

`Animation Blueprint` <br/>

-   动画蓝图需绑定 `Skeleton Mesh` <br/>
-   命名：ABP\_ 打头 <br/>


### 动画混合 {#动画混合}

`Animation Blend` <br/>
流畅地从一个动画切入到另一个动画 <br/>


### 混合空间 {#混合空间}

`Blend Space` <br/>

-   能在两个骨骼动画之间创建过渡动画 <br/>
-   使用插值来得到动画姿势的中间值 <br/>
-   需绑定 `Skeleton Mesh` <br/>
-   命名： `混合空间` 和 `混合空间1D` 均以 BS\_ 打头 <br/>


#### 一维混合空间 {#一维混合空间}

`Blend Space 1D` <br/>
横轴 <br/>


#### 混合空间 {#混合空间}

`Blend Space` <br/>
横轴和纵轴 <br/>


## 重新设置平台 {#重新设置平台}

1.  从场景中移除Floor <br/>
2.  添加 `Geometry/Box` <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/PlaceActors-Geometry-Box.png" width="200" /> <br/> <br/>
3.  恢复 `Box Brush` 默认位置，设置长宽高 <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/BoxBrush-Details.png" width="400" /> <br/> <br/>


## Character运动速度上限 {#character运动速度上限}

`BP_STUBaseCharacter` <br/>
`CharacterMovementComponent` <br/>

1.  `选择CharacterMovementComponent > 细节面板 > Character Movement: Walking > MaxWalkSpeed` <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/CharacterMovement-Details-MaxWalkSpeed.png" width="1200" /> <br/> <br/>
    
    `MaxWalkSpeed` 即 Character 的最大运动速度，单位 `cm/s` <br/>
    
    虚幻引擎里的步长使用 `cm` <br/>
2.  修改 `MaxWalkSpeed` ，当速度改为 `1600` 时，可以看到单位时间内移动的距离增加，而跑步动画缺少对应的加速过程 <br/>


## 获取实时速度并打印 {#获取实时速度并打印}

`BP_STUBaseCharacter` <br/>

1.  在 `EventGraph` 实现 <br/>
    
    | -                     |               |                                            |
    |-----------------------|---------------|--------------------------------------------|
    | GetVelocity函数       | 获取Character速度 | 获得Actor各个方向上的速度，保存在FVector中 |
    | FVector::VectorLength | 获得速度标量  |                                            |
    | PrintString           | 在屏幕上输出实时速度 | `PrintString` 使用 `AddOnScreenDebugMessage` |
    
    <img src="/pic/角色和动画/添加向前走路动画/在屏幕上输出实时速度.png" width="700" /> <br/> <br/>
    
    可以看到加速过程 <br/>
2.  移除打印 <br/>


## 创建动画蓝图ABP_BaseCharacter {#创建动画蓝图abp-basecharacter}

`Animation Blueprint` <br/>


### 创建文件夹Content/Players/Animations {#创建文件夹content-players-animations}


### 方法一: 基于Skeleton Mesh创建动画蓝图 {#方法一-基于skeleton-mesh创建动画蓝图}

`选中ExternalContent/Animation/Characters/HeroTPP/HeroTPP > 右键 > Create > AnimBlueprint` <br/>

<img src="/pic/角色和动画/添加向前走路动画/HeroTPP-Create-AnimBlueprint.png" width="600" /> <br/> <br/>


### 方法二: 在指定位置创建动画蓝图 {#方法二-在指定位置创建动画蓝图}

1.  `去到 Content/Player/Animations，右键 > Animation > 选择Animation Blueprint` <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/在指定位置创建动画蓝图.png" width="700" /> <br/> <br/>
2.  选择 `HeroTPP_Skeleton` <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/AnimationBlueprint-HeroTPP_Skeleton.png" width="350" /> <br/> <br/>
3.  命名为 `ABP_BaseCharacter` <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/Animations-ABP_BaseCharacter.png" width="350" /> <br/> <br/>


## 在蓝图编辑器中查看动画蓝图 {#在蓝图编辑器中查看动画蓝图}

`ABP_BaseCharacter` <br/>

| -            |        |                                                          |
|--------------|--------|----------------------------------------------------------|
| EventGraph   | 事件图表 | 处理各种动画事件；像使用 `Tick` 一样使用 `EventBlueprintUpdateAnimation` |
| AnimGraph    | 动画图表 | 处理所有动画；可以将动画资产作为 `OutputPose` 的输入     |
| AssetBrowser | 动画资产窗口 | 可以从 `Window > AssetBrowser` 打开，罗列了 `SkeletonMesh` 所有相关动画 |

<img src="/pic/角色和动画/添加向前走路动画/ABP_BaseCharacter.png" width="1200" /> <br/> <br/>


## 为游戏角色设置动画时使用动画蓝图 {#为游戏角色设置动画时使用动画蓝图}


### 为ABP_BaseCharacter设置输入 {#为abp-basecharacter设置输入}

`动画图表` <br/>

1.  将 `Run_Fwd` 作为 `OutputPose` 的输入 <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/将Run_Fwd作为OutputPose的输入.png" width="400" /> <br/> <br/>
2.  设置 `Run_Fwd` 重复播放 <br/>
    `选中Run_Fwd > Details > Settings > 使能 LoopAnimation` <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/ABP_BaseCharacter-AnimGraph-RunFwd-LoopAnimation.png" width="300" /> <br/> <br/>


### 让Character使用动画蓝图 {#让character使用动画蓝图}

`BP_STBaseCharacter` <br/>

| -              |                         |
|----------------|-------------------------|
| Animation Mode | Use Animation Blueprint |
| Anim Class     | ABP_BaseCharacter       |

<img src="/pic/角色和动画/添加向前走路动画/BP_STUBaseCharacter-UseAnimationBlueprint-ABP_BaseCharacter.png" width="1300" /> <br/> <br/>


## 查看动画资产 {#查看动画资产}

`去到Content/ExternalContent/Animation/Animations/TTP_Animations，双击 Run_Fwd` <br/>

<img src="/pic/角色和动画/添加向前走路动画/Run_Fwd.png" width="1200" /> <br/> <br/>

可在 `AssetBrowser` 中选择其他动画 <br/>


## 混合空间资产 {#混合空间资产}

`Blend Space` <br/>

速度从 `0` - `600` ，动画从 `Idle` 过渡到 `Run_Fwd` <br/>


### 创建BS_Locomotion_Walk_1D {#创建bs-locomotion-walk-1d}

1.  `去到Content/Player/Animations，右键` <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/创建BlendSpace1D.png" width="800" /> <br/> <br/>
2.  选择 `HeroTPP_Skeleton` <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/BS_Locomotion_Walk_1D-HeroTPP_Skeleton.png" width="450" /> <br/> <br/>
3.  命名为 `BS_Locomotion_Walk_1D` <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/Animations-BS_Locomotion_Walk_1D.png" width="950" /> <br/> <br/>


### 配置BS_Locomotion_Walk_1D {#配置bs-locomotion-walk-1d}

1.  双击打开 `BS_Locomotion_Walk_1D` <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/BS_Locomotion_Walk_1D.png" width="1400" /> <br/> <br/>
2.  配置横轴 <br/>
    `Asset Details > Axis Settings > Horizontal Axis` <br/>
    
    |                    |      |          | 说明               |
    |--------------------|------|----------|------------------|
    | Name               | 名称 | Velocity |                    |
    | Minimum Axis Value | 轴最小值 | 0        |                    |
    | Maximum Axis Value | 轴最大值 | 600      | 游戏角色运动速度上限 |
    | Grid Divisions     | 过渡区间 | 4        | 使用默认值；和可以添加的动画个数有关 |
    
    <img src="/pic/角色和动画/添加向前走路动画/BS_Locomotion_Walk_1D-AssetDetails-配置轴.png" width="350" /> <br/> <br/>
3.  配置动画 <br/>
    
    |    | 动画资产 | Velocity |
    |----|------|----------|
    | 起点 | Idle    | 0        |
    | 终点 | Run_Fwd | 600      |
4.  查看插值 <br/>
    
    | 系统    | 键位    |
    |-------|-------|
    | Windows | Control |
    | MacOS   | Command |
    
    按下键位，水平移动鼠标，绿色X随之在起点和终点间移动，视口展示过渡动画 <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/BS_Locomotion_Walk_1D-过渡动画.png" width="700" /> <br/> <br/>


## 将BS_Locomotion_Walk_1D作为动画蓝图输入 {#将bs-locomotion-walk-1d作为动画蓝图输入}

`ABP_BaseCharacter` <br/>


### 添加变量Velocity {#添加变量velocity}

在 `MyBlueprint` 添加变量 `Velocity` ，在Details设置名称和类型 <br/>

<img src="/pic/角色和动画/添加向前走路动画/ABP_BaseCharacter-添加变量-Float-Velocity.png" width="1300" /> <br/> <br/>


### 设置变量Velocity {#设置变量velocity}

`EventGraph` <br/>

1.  将变量Velocity拖动到EventGraph, 选择设置变量值 <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/ABP_BaseCharacter-EventGraph-Velocity.png" width="100" /> <br/> <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/ABP_BaseCharacter-EventGraph-Velocity-Result.png" width="150" /> <br/> <br/>
2.  在 `EventBlueprintUpdateAnimation` 之后，执行 `SetVelocity` <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/ABP_BaseCharacter-EventGraph-SetVelocity.png" width="400" /> <br/> <br/>
3.  `GetPawnOwner` 返回 `Pawn` 实例的引用, 变量 `Velocity` 的输入是 `Actor` 实时速度 <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/ABP_BaseCharacter-EventGraph-Final.png" width="800" /> <br/> <br/>


### 设置动画蓝图输入 {#设置动画蓝图输入}

`AnimGraph` <br/>

1.  将BS_Locomotion_Walk_1D作为OutputPose的输入 <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/ABP_BaseCharacter-BS_Locomotion_Walk_1D作为OutputPose输入.png" width="500" /> <br/> <br/>
2.  将变量Velocity拖动到AnimGraph, 选择获取变量值 <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/ABP_BaseCharacter-AnimGraph-Velocity.png" width="100" /> <br/> <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/ABP_BaseCharacter-AnimGraph-Velocity-Get.png" width="150" /> <br/> <br/>
3.  将变量Velocity作为BS_Locomotion_Walk_1D的输入 <br/>
    
    <img src="/pic/角色和动画/添加向前走路动画/ABP_BaseCharacter-AnimGraph-Final.png" width="700" /> <br/> <br/>

