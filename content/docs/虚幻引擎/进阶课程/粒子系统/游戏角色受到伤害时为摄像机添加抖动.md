---
title: "游戏角色受到伤害时为摄像机添加抖动"
date: 2023-10-15T17:44:34
lastmod: 2023-10-15T19:35:52+08:00
draft: false
weight: 2007
---

## 说明 {#说明}

`MatineeCameraShake` 已被 `LegacyCameraShake` 取代 <br/>


## 创建抖动蓝图类 {#创建抖动蓝图类}

`Content/VFX` <br/>

右键, `Blueprint Class` <br/>

<img src="/pic/粒子系统/游戏角色受到伤害时为摄像机添加抖动/create-bp.png" width="800" /> <br/> <br/>

选择基类 `LegacyCameraSh` , 命名为BP_DamageCameraShake <br/>

<img src="/pic/粒子系统/游戏角色受到伤害时为摄像机添加抖动/bp-parent.png" width="700" /> <br/> <br/>

开箱即用的解决方案让我们可以很快的实现抖动效果 <br/>

双击打开, 查看细节面板 <br/>

-   `Oscillation > Oscillation Duration` : 摄像机晃动的时间 <br/>
-   绕各轴的振动, 如 `Pitch`, `Yaw`, 和 `Roll` <br/>

<img src="/pic/粒子系统/游戏角色受到伤害时为摄像机添加抖动/oscillation.png" width="600" /> <br/> <br/>


## 测试抖动类 {#测试抖动类}


### 为摄像机添加抖动 {#为摄像机添加抖动}

`BP_STUPlayerController > EventGraph` <br/>

添加节点 `GetPlayerCameraManager` , 作为节点 `StartCameraShake` 的输入; 在Tick函数中调用; 设置抖动类为BP_DamageCameraShake <br/>

<img src="/pic/粒子系统/游戏角色受到伤害时为摄像机添加抖动/bp-tick.png" width="800" /> <br/> <br/>


### 设置抖动时长 {#设置抖动时长}

`BP_DamageCameraShake` <br/>

-   设置 `Oscillation Duration` 为0.2 <br/>
-   添加垂直方向 `Pitch` 和水平方向 `Yaw` 的抖动 <br/>

<img src="/pic/粒子系统/游戏角色受到伤害时为摄像机添加抖动/vibrate.png" width="500" /> <br/> <br/>

-   如果添加摄像机旋转 `Roll` 抖动, 有地板晃动效果, 暂不需要 <br/>
-   抖动参数由设计师提供 <br/>


### 断开摄像机抖动 {#断开摄像机抖动}

`BP_STUPlayerController > EventGraph`      <br/>


## 游戏角色受伤时为摄像机添加抖动 {#游戏角色受伤时为摄像机添加抖动}


### 添加依赖模块GameplayCameras {#添加依赖模块gameplaycameras}

`ShootThemUp: ShootThemUp.Build.cs` <br/>

```cpp
PublicDependencyModuleNames.AddRange(new string[]
{
    "Core",
    "CoreUObject",
    "Engine",
    "InputCore",
    "Niagara",
    "PhysicsCore",
    "GameplayCameras"
});
```


### 添加抖动类属性 {#添加抖动类属性}

`ShootThemUp: Components/STUHealthComponent.h` <br/>
`protected` <br/>

```cpp
class UCameraShakeBase;

UPROPERTY(EditDefaultsOnly, BlueprintReadWrite)
TSubclassOf<UCameraShakeBase> CameraShake;
```


### 添加接口: 使摄像机抖动 {#添加接口-使摄像机抖动}

`ShootThemUp: Components/STUHealthComponent.h` <br/>
`private` <br/>

```cpp
void PlayCameraShake(); 
```

受到伤害时调用 <br/>
`ShootThemUp: Components/STUHealthComponent.cpp` <br/>

```cpp
// OnTakeAnyDamage
PlayCameraShake();
```

要求游戏角色未死亡 <br/>

```cpp
#include "GameFramework/Pawn.h"
#include "GameFramework/PlayerController.h"
#include "LegacyCameraShake.h"

void USTUHealthComponent::PlayCameraShake()
{
    if (IsDead()) return;

    const auto Player = Cast<APawn>(GetOwner());
    if (!Player) return;

    const auto Controller = Player->GetController<APlayerController>();
    if (!Controller || !Controller->PlayerCameraManager) return;

    Controller->PlayerCameraManager->StartCameraShake(CameraShake);
}
```


## 查看 {#查看}

`BP_BaseCharacter` <br/>
设置抖动类为BP_DamageCameraShake <br/>

<img src="/pic/粒子系统/游戏角色受到伤害时为摄像机添加抖动/shake-class.png" width="500" /> <br/> <br/>

选中伤害球, 调整伤害数值 <br/>
`Details > Damage` , 设为0.5 <br/>

<img src="/pic/粒子系统/游戏角色受到伤害时为摄像机添加抖动/blue-damage.png" width="500" /> <br/> <br/>

<img src="/pic/粒子系统/游戏角色受到伤害时为摄像机添加抖动/red-damage.png" width="500" /> <br/> <br/>

当受到其他游戏角色的射击伤害时, 有所察觉 <br/>

