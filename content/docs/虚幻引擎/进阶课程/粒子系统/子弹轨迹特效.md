---
title: "子弹轨迹特效"
date: 2023-10-17T01:49:09
lastmod: 2023-10-17T12:11:29+08:00
draft: false
weight: 2011
---

## 说明 {#说明}

子弹在空间中的轨迹 <br/>

图示只做说明 <br/>


## 修正榴弹弹痕体积 {#修正榴弹弹痕体积}

`BP_STUProjectile` <br/>

<img src="/pic/粒子系统/子弹轨迹特效/projectile-size.png" width="500" /> <br/> <br/>


## 修正枪口特效 {#修正枪口特效}

`NE_LauncherFlash` <br/>

-   火花样式 <br/>
    弹射旋转 `Sprite Rotation` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/cancel-sprite-rotation.png" width="800" /> <br/> <br/>
    
    调整 `Scale Sprite Size` 和 `Sprite Rotation Rate` 顺序, 设置旋转比例范围 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/modify-rotation-rate.png" width="800" /> <br/> <br/>
-   解决神龙甩尾效果 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/tight-spark-to-muzzle.png" width="800" /> <br/> <br/>
-   减小火花 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/smaller.png" width="800" /> <br/> <br/>


## 修正榴弹冲击特效 {#修正榴弹冲击特效}

`NS_ProjectileImpact` <br/>


### SimpleSpriteBurst {#simplespriteburst}

腾云特效 <br/>

-   设置时长 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/sprite-duration.png" width="700" /> <br/> <br/>
-   粒子数 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/sprite-count.png" width="700" /> <br/> <br/>
-   生存时间和大小 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/sprite-lifetime-size.png" width="700" /> <br/> <br/>
-   分布属性 <br/>
    添加 <br/>
    
    <img src="pic/粒子系统/子弹轨迹特效/sprite-add-location.png" alt="sprite-add-location.png" width="500" /> <br/>
    设置半径和原型 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/sprite-radius-origin.png" width="700" /> <br/> <br/>
-   排序 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/sprite-sort.png" width="700" /> <br/> <br/>


### UpwardMeshBurst {#upwardmeshburst}

箭簇特效 <br/>

-   粒子数 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/um-count.png" width="700" /> <br/> <br/>
-   生存期, 颜色, 体积等 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/um-initial.png" width="700" /> <br/> <br/>
-   取消模块勾选 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/um-uncheck.png" width="400" /> <br/> <br/>
-   大小分布 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/um-scale-size.png" width="700" /> <br/> <br/>
-   移除不需要的网格体等 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/um-remove-ele.png" width="700" /> <br/> <br/>


### OmnidirectionalBurst {#omnidirectionalburst}

击碎雪球特效 <br/>

-   添加属性 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/omni-by-mass.png" width="700" /> <br/> <br/>
-   调整属性位置, 设置圆形分布半径等 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/omni-location.png" width="700" /> <br/> <br/>
-   排序 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/omni-sort.png" width="700" /> <br/> <br/>


## 实现轨迹特效 {#实现轨迹特效}

创建文件夹 `Content/VFX/Trace` , 创建下属文件夹 `Projectile` 和 `Rifle` <br/>


### 创建步枪子弹轨迹用粒子发射器 {#创建步枪子弹轨迹用粒子发射器}

`Content/VFX/Trace/Rifle` <br/>

基于模板Dynamic Beam, 命名为NE_RifleBeam <br/>

<img src="/pic/粒子系统/子弹轨迹特效/dynamic-beam.png" width="400" /> <br/> <br/>

-   `Initialize Particle` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/beam-lifetime.png" width="700" /> <br/> <br/>
-   `Beam Width` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/beam-width.png" width="700" /> <br/> <br/>
-   `Color` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/beam-color.png" width="700" /> <br/> <br/>


### 创建步枪子弹轨迹用粒子系统 {#创建步枪子弹轨迹用粒子系统}

`Content/VFX/Trace/Rifle` <br/>

使用粒子发射器NE_RifleBeam <br/>

命名为NS_RifleBeam <br/>


### 创建榴弹轨迹用粒子发射器 {#创建榴弹轨迹用粒子发射器}

`Content/VFX/Trace/Projectile` <br/>


#### NE_BlueCore {#ne-bluecore}

基于模板SimpleSpriteBurst <br/>

<img src="/pic/粒子系统/子弹轨迹特效/bc-sprite.png" width="400" /> <br/> <br/>

-   `Properties` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/bc-properties.png" width="700" /> <br/> <br/>
-   `Emitter State` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/bc-state.png" width="700" /> <br/> <br/>
-   `Spawn Burst Instantaneous` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/bc-count.png" width="700" /> <br/> <br/>
-   `Initialize Particle` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/bc-initial.png" width="700" /> <br/> <br/>
-   `Scale Color` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/bc-scale-color.png" width="700" /> <br/> <br/>
-   添加模块 `Scale Sprite Size` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/bc-add-scale-size.png" width="500" /> <br/> <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/bc-scale-size.png" width="300" /> <br/> <br/>
-   添加模块 `Sprite Rotation Rate` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/bc-add-rotate-rate.png" width="500" /> <br/> <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/bc-rotate-rate.png" width="700" /> <br/> <br/>
-   `Sprite Renderer` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/bc-render.png" width="700" /> <br/> <br/>


#### NE_Electric {#ne-electric}

基于模板SimpleSpriteBurst <br/>

-   `Properties` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/electric-properties.png" width="700" /> <br/> <br/>
-   `Emitter State` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/electric-state.png" width="700" /> <br/> <br/>
-   添加模块: `Spawn Rate` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/electric-add-spawn-rate.png" width="500" /> <br/> <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/electric-spawn-rate.png" width="700" /> <br/> <br/>
-   `Initialize Particle` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/electric-initial.png" width="700" /> <br/> <br/>
-   添加模块: `Shape Location` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/electric-add-location.png" width="700" /> <br/> <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/electric-location.png" width="700" /> <br/> <br/>
-   `Scale Color` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/electric-scale-color.png" width="700" /> <br/> <br/>
-   添加模块: `Scale Sprite Size` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/electric-add-scale-size.png" width="700" /> <br/> <br/>
-   添加模块: `Sprite Rotation Rate` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/electric-add-rotate-rate.png" width="700" /> <br/> <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/electric-rotate-rate.png" width="700" /> <br/> <br/>
-   添加模块: `Sub UVAnimation` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/electric-add-UV.png" width="700" /> <br/> <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/electric-uv.png" width="700" /> <br/> <br/>
-   `Sprite Renderer` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/electric-render.png" width="700" /> <br/> <br/>


#### NE_Fountain {#ne-fountain}

基于模板Fountain <br/>

-   `Spawn Rate` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/ft-spawn-rate.png" width="700" /> <br/> <br/>
-   `Initialize Particle` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/ft-initial.png" width="700" /> <br/> <br/>
-   `Shape Location` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/ft-location.png" width="700" /> <br/> <br/>
-   `Add Velocity` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/ft-velocity.png" width="700" /> <br/> <br/>
-   `Gravity Force` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/ft-gravity.png" width="200" /> <br/> <br/>
-   添加模块: `Collision` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/ft-add-collision.png" width="500" /> <br/> <br/>
-   添加模块: `Acceleration Force` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/ft-add-force.png" width="500" /> <br/> <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/ft-force.png" width="700" /> <br/> <br/>
-   `Sprite Renderer` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/ft-render.png" width="700" /> <br/> <br/>

<!--list-separator-->

-  添加模块Scale Velocity

    -   定位 `Add Velocity` 模块位置 <br/>
        
        <img src="/pic/粒子系统/子弹轨迹特效/locate-add-velocity.png" width="300" /> <br/> <br/>
    -   Scale Velocity在库中隐藏 <br/>
        
        <img src="/pic/粒子系统/子弹轨迹特效/scale-velocity.png" width="1000" /> <br/> <br/>
    -   拖动 `Scale Velocity` 到NE_Fountain中, 添加该模块 <br/>
        
        <img src="/pic/粒子系统/子弹轨迹特效/ft-add-scale-velocity.png" width="1000" /> <br/> <br/>
    -   设置 <br/>
        
        <img src="/pic/粒子系统/子弹轨迹特效/ft-scale-velocity.png" width="700" /> <br/> <br/>


#### NE_Smoke {#ne-smoke}

基于模板Fountain <br/>

-   `Spawn Rate` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/smoke-spawn-rate.png" width="700" /> <br/> <br/>
-   `Initialize Particle` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/smoke-initial.png" width="700" /> <br/> <br/>
-   `Scale Color` <br/>
    X、Y和Z终点 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/smoke-scale-color-end.png" width="700" /> <br/> <br/>
    
    Z起点 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/smoke-scale-color-bs.png" width="700" /> <br/> <br/>
    
    Y起点 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/smoke-scale-color-gs.png" width="700" /> <br/> <br/>
    
    X起点 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/smoke-scale-color-rs.png" width="700" /> <br/> <br/>
-   取消未使用模块勾选 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/smoke-uncheck.png" width="200" /> <br/> <br/>
-   添加模块: `Scale Sprite Size` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/smoke-add-scale-size.png" width="700" /> <br/> <br/>
    
    起点 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/smoke-scale-size-start.png" width="700" /> <br/> <br/>
    
    终点 <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/smoke-scale-size-end.png" width="700" /> <br/> <br/>
-   添加模块: `Sub UVAnimation` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/smoke-add-UV.png" width="700" /> <br/> <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/smoke-uv.png" width="600" /> <br/> <br/>
-   `Sprite Renderer` <br/>
    
    <img src="/pic/粒子系统/子弹轨迹特效/smoke-render.png" width="700" /> <br/> <br/>


### 创建榴弹轨迹用粒子系统 {#创建榴弹轨迹用粒子系统}

`Content/VFX/Trace/Projectile` <br/>

使用现有发射器 <br/>

<img src="/pic/粒子系统/子弹轨迹特效/projectile-trace-selected.png" width="400" /> <br/> <br/>

依次选择NE_CoreBlue, NE_Electric, NE_Smoke, NE_Fountain <br/>

<img src="/pic/粒子系统/子弹轨迹特效/selected-emitter.png" width="400" /> <br/> <br/>

命名为NS_ProjectileTrace <br/>


### 为轨迹终点绑定变量 {#为轨迹终点绑定变量}

`Content/VFX/Trace/Rifle/NS_RifleBeam` <br/>


#### 调试终点 {#调试终点}

`Beam Emitter Setup` <br/>

设置Beam End &gt; X = 1200, 光束更长; 绘制轨迹时, 对该参数进行设置 <br/>


#### 不使用相对座标, 而是世界座标 {#不使用相对座标-而是世界座标}

勾选 `Absolute Beam End` <br/>

<img src="/pic/粒子系统/子弹轨迹特效/check-absolute.png" width="700" /> <br/> <br/>


### 绑定变量 {#绑定变量}

`NS_RifleBeam` <br/>

添加变量, 设置变量类型为Vector <br/>
`Parameters > User Exposed` <br/>

<img src="/pic/粒子系统/子弹轨迹特效/create-trace-target.png" width="600" /> <br/> <br/>

命名为TraceTarget <br/>

<img src="/pic/粒子系统/子弹轨迹特效/trace-target.png" width="500" /> <br/> <br/>

为Beam End绑定变量TraceTarget <br/>
`NE_RifleBeam > Beam Emitter Setup > Beam End` <br/>

<img src="/pic/粒子系统/子弹轨迹特效/bind-trace-target.png" width="700" /> <br/> <br/>


### 设置特效只播放一次 {#设置特效只播放一次}

`NS_RifleBeam > NE_RifleBeam > Emitter State > Loop Behavior` <br/>

<img src="/pic/粒子系统/子弹轨迹特效/loop-once.png" width="700" /> <br/> <br/>


## 在C++中为步枪生成轨迹特效 {#在c-plus-plus-中为步枪生成轨迹特效}

生成轨迹特效, 设置TraceTarget变量 <br/>


### 添加变量: 保存轨迹特效类型 {#添加变量-保存轨迹特效类型}

`ShootThemUp: Weapon/STURifleWeapon.h` <br/>
`protected` <br/>

```cpp
class UNiagaraSystem;

UPROPERTY(EditDefaultsOnly, BlueprintRead
          Write)
UNiagaraSystem *TraceFX;
```


### 添加变量: 存放轨迹终点变量名 {#添加变量-存放轨迹终点变量名}

`ShootThemUp: Weapon/STURifleWeapon.h` <br/>
`protected` <br/>

```cpp
UPROPERTY(EditDefaultsOnly, BlueprintReadWrite)
FString TraceTargetName = "TraceTarget";
```


### 添加函数: 绘制轨迹特效 {#添加函数-绘制轨迹特效}

`ShootThemUp: Weapon/STURifleWeapon.h` <br/>
`private` <br/>

```cpp
void SpawnTraceFX(const FVector &TraceStart, const FVector &TraceEnd);
```


#### 射击时调用 {#射击时调用}

-   之前有绘制轨迹示意图, 屏蔽未射中分支 <br/>
-   若击中, 更新终点 <br/>
-   生成轨迹特效 <br/>

`ShootThemUp: Weapon/STURifleWeapon.cpp` <br/>

```cpp
// MakeShot

FVector TraceFXEnd = TraceEnd;
if (HitResult.bBlockingHit)
{
    TraceFXEnd = HitResult.ImpactPoint;
    // ...
}
SpawnTraceFX(GetMuzzleWorldLocation(), TraceFXEnd);
```


#### 实现 {#实现}

```cpp
#include "NiagaraFunctionLibrary.h"

void ASTURifleWeapon::SpawnTraceFX(const FVector &TraceStart, const FVector &TraceEnd)
{
    const auto TraceFXComponent = UNiagaraFunctionLibrary::SpawnSystemAtLocation(GetWorld(), TraceFX, TraceStart);
    if (TraceFXComponent)
    {
        TraceFXComponent->SetNiagaraVariableVec3(TraceTargetName, TraceEnd);
    }
}
```


## 查看步枪子弹轨迹 {#查看步枪子弹轨迹}

`BP_STURifleWeapon` <br/>

设置特效类 <br/>

<img src="/pic/粒子系统/子弹轨迹特效/set-tracefx.png" width="800" /> <br/> <br/>


## 为榴弹添加轨迹特效 {#为榴弹添加轨迹特效}

`BP_STUProjectile` <br/>


### 为其添加Niagara Particle System组件 {#为其添加niagara-particle-system组件}

<img src="/pic/粒子系统/子弹轨迹特效/add-npsc.png" width="400" /> <br/> <br/>

命名为TraceFXComponent, 为其设置粒子系统 <br/>

<img src="/pic/粒子系统/子弹轨迹特效/set-ns.png" width="1200" /> <br/> <br/>


### 关闭特效渲染 {#关闭特效渲染}

`BP_STUProjectile` <br/>

`TraceFXComponent > Details > Rendering > Visible` , 取消勾选 <br/>

<img src="/pic/粒子系统/子弹轨迹特效/uncheck-visibility.png" width="1200" /> <br/> <br/>


### 使用发光材质 {#使用发光材质}


#### 创建材质实例 {#创建材质实例}

拷贝MI_BlueGlow `Ctrl-D`, 命名为MI_ProjectileGlow <br/>

设置颜色Hex Linear = 006AE100 <br/>

<img src="/pic/粒子系统/子弹轨迹特效/set-hex-linear.png" width="400" /> <br/> <br/>

设置发光参数为500 <br/>

<img src="/pic/粒子系统/子弹轨迹特效/set-glow.png" width="400" /> <br/> <br/>


#### 使用材质实例 {#使用材质实例}

`BP_STUProjectile` <br/>

为静态网格体应用材质MI_ProjectileGlow <br/>

<img src="/pic/粒子系统/子弹轨迹特效/apply-projectile-glow.png" width="1200" /> <br/> <br/>


### 添加点光源组件 {#添加点光源组件}

`Point Light` <br/>

<img src="/pic/粒子系统/子弹轨迹特效/add-point.png" width="200" /> <br/> <br/>

设置颜色Hex Linear = 006AE100 <br/>
`Details > Light > Light Color` <br/>

<img src="/pic/粒子系统/子弹轨迹特效/set-hex-linear2.png" width="300" /> <br/> <br/>


### 恢复特效渲染 {#恢复特效渲染}


## 遗留问题 {#遗留问题}

榴弹爆炸时, 烟雾和其他特效一起消散. 一个更好的做法, 其他特效消散, 保留烟雾效果. 比如, 设置榴弹延后销毁 <br/>

