---
title: "生命补给"
date: 2023-10-11T17:52:06
lastmod: 2023-10-16T00:38:09+08:00
draft: false
weight: 2005
---

## 生命补给逻辑 {#生命补给逻辑}


### 添加属性 {#添加属性}

`ShootThemUp: Pickups/STUHealthPickup.h` <br/>
`protected` <br/>

```cpp
UPROPERTY(EditAnywhere, BlueprintReadWrite, meta = (ClampMin = "1.0", ClampMax = "100.0"))
float HealthAmount = 100.0f;
```


### 添加接口: 若非死亡跌倒或组件不可寻, 调用健康组件接口 {#添加接口-若非死亡跌倒或组件不可寻-调用健康组件接口}

`ShootThemUp: Pickups/STUHealthPickup.cpp` <br/>

```cpp
#include "Components/STUHealthComponent.h"
#include "GameFramework/Pawn.h"
#include "STUUtils.h"

// GivePickupTo

const auto HealthComponent = STUUtils::GetSTUPlayerComponent<USTUHealthComponent>(PlayerPawn);
if (!HealthComponent || HealthComponent->IsDead()) return false;

return HealthComponent->TryToAddHealth(HealthAmount);
```


## 生命组件逻辑 {#生命组件逻辑}

`ShootThemUp: Components/STUHealthComponent.h` <br/>
`public` <br/>

```cpp
bool TryToAddHealth(float HealthAmount);
bool IsHealthFull() const;
```

`ShootThemUp: Components/STUHealthComponent.cpp` <br/>

```cpp
bool USTUHealthComponent::IsHealthFull() const
{
    return FMath::IsNearlyEqual(Health, MaxHealth);
}

bool USTUHealthComponent::TryToAddHealth(float HealthAmount)
{
    if (IsHealthFull()) return false;
    SetHealth(Health + HealthAmount);
    return true;
}
```


### 修改当前接口调用: 使用IsHealthFull {#修改当前接口调用-使用ishealthfull}

`ShootThemUp: Components/STUHealthComponent.cpp` <br/>

```cpp
// OnTakeAnyDamage

// OnHeal
```


## 查看 {#查看}

设置治疗频率 <br/>
`BP_STUBaseCharacter` <br/>

<img src="/pic/补给/生命补给/heal-rate.png" width="1000" /> <br/> <br/>

